[{"content":" CLI å°å·¥å…·ç³»åˆ— Introduction #å› æ‡‰å·¥ä½œéœ€æ±‚ï¼Œä½¿ç”¨åˆ° GCP ä»¥åŠ AWS æœå‹™ï¼Œ\nåˆå› ç‚º DR çš„é—œä¿‚ï¼ŒGCP è·Ÿ AWS ä¹‹é–“æœ‰å»ºç½® Site-to-Site VPNã€‚\nGCP çš„ç¶²è·¯ç’°å¢ƒæ˜¯ä½¿ç”¨ Shared VPC ( XPN )ï¼Œç„¶å¾Œåœ¨ 2 å€‹ä¸åŒçš„ Projectï¼›\nAWS çš„ç¶²è·¯ç’°å¢ƒæ˜¯ä½¿ç”¨ Resource Access Manager ( RAM ) åˆ†äº«ï¼Œç¨ç«‹åœ¨ 1 å€‹ Account\næœ€è¿‘é–‹å§‹å®‰æ’äº†å»ºç½® DR ç›¸é—œçš„ RDS ä»»å‹™ï¼Œ\næ‰€ä»¥äº‹å‰è¦æª¢æŸ¥ä¸€ä¸‹ç¶²è·¯ç›¸é—œçš„é…ç½®æ™‚ï¼Œ\nç™¼ç¾ è¶…ç´šéº»ç…©\næˆ‘éœ€è¦å…ˆç¢ºèª GCP çš„ GCE Project ä½¿ç”¨äº†å“ªäº› XPNï¼Œ\nå†åˆ°é€™äº› GCE æ‰€ä½¿ç”¨çš„ XPN æª¢æŸ¥ Cloud VPN tunnels çš„é…ç½®ï¼Œ\nç¢ºèªè·Ÿ AWS site çš„ä¸²æ¥æ˜¯å¦æ­£ç¢ºï¼Œ\né‚„è¦ç¢ºèªæ˜¯å¦æœ‰æ­£ç¢ºå®£å‘Š BGP çµ¦ AWSï¼Œ\næœ€å¾Œæª¢æŸ¥\nGCP çš„ FW è¨­å®šï¼Œ\næœ‰æ²’æœ‰é–‹æ”¾ AWS çš„ç¶²æ®µï¼Œ\nAWS çš„ SG è¨­å®šï¼Œ\næœ‰æ²’æœ‰é–‹æ”¾ GCP çš„ç¶²æ®µ\næ„Ÿè¦ºä¹Ÿé‚„å¥½å‘€ï¼Œ\nå¦‚æœåªéœ€è¦ç¢ºèªä¸€æ¬¡çš„è©±æˆ‘ä¹Ÿè¦ºå¾—é‚„å¥½å‘€ !\nä½†æˆ‘å€‘æœ‰ 24 å€‹ GCP Projectï¼Œ\næ¯å€‹ VPN æœ‰ 2 æ¢ VPN tunnelï¼Œ\nVPN æ˜¯ HA VPNï¼Œæ‰€ä»¥å† * 2\nåˆå› ç‚ºå…¬å¸ MacBook æ˜¯ 19 å¹´çš„å¤è‘£æ©Ÿï¼Œ\næ¯æ¬¡çœ‹åˆ° GCP çš„é é¢ä¸€ç›´è½‰åœˆåœˆï¼Œ\nå¤šé–‹äº†ä¸‰å››äº”å…­å€‹è¦–çª—ï¼ŒSafari ä¸€è¨€ä¸åˆå°±é–ƒé€€ï¼Œ\né›–ç„¶ä½¿ç”¨ gcloud è·Ÿ aws ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œä½†éƒ¨åˆ†æŒ‡ä»¤ä¸å¤ªç†Ÿåˆéœ€è¦ä¸€ç›´çˆ¬ Doc\né€™æ™‚ï¼Œå‰›å¥½çœ‹åˆ°ä¸€å€‹ Toolingï¼Œ\nä¸»æ‰“ä½¿ç”¨ SQL å‹•æ…‹æŸ¥è©¢ Cloud çš„è³‡æºï¼Œ\nèº«ç‚ºä¸€å€‹ DBAï¼Œçœ‹åˆ° SQL èªæ³•å€æ„Ÿè¦ªåˆ‡ï¼Œ\nä»Šå¤©ï¼Œæˆ‘å€‘å°±ä¾†ä»‹ç´¹é€™ Tooling - Steampipe\nWhat\u0026rsquo;s Steampipe # Steampipe æ˜¯ä¸€å€‹ä¸»æ‰“ Zero-ETL çš„å·¥å…·ï¼Œ\næœƒå”åŠ©æˆ‘å€‘ç›´æ¥é€šé API æˆ–æœå‹™ä¾†å–å¾—è³‡æ–™ï¼Œ\nè®“æˆ‘å€‘ä½¿ç”¨ PostgreSQL ä»‹é¢æŸ¥è©¢è³‡æ–™\nå…ˆä¾†å¼µå®˜æ–¹çš„æ¶æ§‹åœ– å¯¦ç¾æ–¹å¼æ˜¯æ¡ç”¨ PostgreSQL çš„ Foreign-Data Wrapper åŠŸèƒ½\nHow to Install Steampipe # é¦–å…ˆï¼ŒMacBook å¯ä»¥ç›´æ¥ä½¿ç”¨ Homebrew ä¾†å®‰è£ steampipe brew install turbot/tap/steampipe å…¶é¤˜ç³»çµ±çš„å®‰è£æ–¹å¼è«‹åƒè€ƒ Steampipe å®˜æ–¹æ–‡ä»¶\nç¢ºèªç‰ˆæœ¬è³‡è¨Š steampipe -v # å®‰è£æˆåŠŸå¾Œæœƒé¡¯ç¤ºç‰ˆæœ¬è³‡è¨Š Steampipe v2.1.0 Install the plugin #Steampipe éœ€è¦é¡å¤–å®‰è£ä¸åŒ plugin ä¾†æ”¯æ´å„ç¨® venderï¼Œ\né€™é‚Šä»¥ AWS è·Ÿ GCP ç‚ºä¾‹\nå®‰è£ AWS plugin steampipe plugin install aws å®‰è£ GCP plugin steampipe plugin install gcp Steampipe é è¨­æœƒä½¿ç”¨ Default çš„ AWS Credentials è·Ÿ GCP çš„ Application Default Credentialsï¼Œ\nä½†å°±å¦‚åŒä¸Šè¿°æéçš„ï¼Œæˆ‘å€‘ GCP çš„ç¶²è·¯ç’°å¢ƒä½¿ç”¨äº† 2 å€‹ä¸åŒ Project çš„ XPNï¼Œ\næ‰€ä»¥æˆ‘æœ‰æ–°å¢é¡å¤–çš„é€£ç·šä¾†è®“æˆ‘æ–¹ä¾¿ä¸€æ¬¡æ’ˆå–ä¸åŒ Project çš„è³‡è¨Š\nSteampipe çš„ç›¸é—œè¨­å®šæª”æ”¾åœ¨ ${HOME}/.steampipe åº•ä¸‹ï¼Œ\næ‰€ä»¥æˆ‘å€‘å¯ä»¥å¾é€™é‚Šä¾†æ–°å¢é¡å¤–çš„é€£ç·šè³‡è¨Š\nGCP æ–°å¢é€£ç·šè³‡è¨Š nvim ${HOME}/.steampipe/config/gcp.spc # åœ¨æœ€ä¸‹é¢æ–°å¢ connection \u0026#34;Schema åç¨±\u0026#34; { plugin = \u0026#34;gcp\u0026#34; project = \u0026#34;Project ID\u0026#34; } ä»¥æˆ‘çš„ä¾‹å­ä¾†èªªï¼Œè¨­å®šå¾Œçš„å…§å®¹å¦‚ä¸‹ å‘½åè¦å‰‡å°±åªæ˜¯å–®ç´”çš„ç²—æš´ç°¡å–®ï¼ŒGCP ç¬¬ 1 å€‹è·Ÿç¬¬ 2 å€‹ ğŸ˜‚\nAWS çš„éƒ¨åˆ†å€’æ˜¯æ²’æœ‰ç‰¹åˆ¥è¨­å®šï¼Œåªæœ‰ä¿®æ”¹ regions çš„éƒ¨åˆ†\nnvim ${HOME}/.steampipe/config/aws.spc # å› ç‚ºæˆ‘å€‘æœ‰å¤šå€åŸŸï¼Œæ‰€ä»¥åœ¨ regions çš„éƒ¨åˆ†æ–°å¢å¤šå€åŸŸ connection \u0026#34;aws\u0026#34; { plugin = \u0026#34;aws\u0026#34; regions = [\u0026#34;ap-northeast-1\u0026#34;, \u0026#34;ap-southeast-1\u0026#34;] } Usage #é…ç½®å¥½ä¹‹å¾Œå°±å¯ä»¥å¿«æ¨‚çš„ SQL å›‰ ğŸ¤—\nsteampipe query --output line æ’ˆå– AWS è·Ÿ GCP Site-to-Site VPN çš„é…ç½® #SELECT v.account_id AS \u0026#34;AWS Account gateway\u0026#34;, v.title AS \u0026#34;AWS VPN Name\u0026#34;, i-\u0026gt;\u0026gt;\u0026#39;OutsideIpAddress\u0026#39; AS \u0026#34;Peer IP\u0026#34; , g.project AS \u0026#34;GCP Project\u0026#34; , g.name AS \u0026#34;GCP Router Name\u0026#34; FROM aws_vpc_vpn_connection AS v , LATERAL JSONB_ARRAY_ELEMENTS(options-\u0026gt;\u0026#39;TunnelOptions\u0026#39;) AS i JOIN gcp_compute_vpn_tunnel AS g ON ( i-\u0026gt;\u0026gt;\u0026#39;OutsideIpAddress\u0026#39; = ABBREV(g.peer_ip) ) ORDER BY 1 , 2 Result æ’ˆå– GCP FW Allow AWS Subnet çš„é…ç½® #WITH g AS ( SELECT g.name , SPLIT_PART(g.network, \u0026#39;/\u0026#39;, -1) AS vpc , g.source_ranges , g.target_tags FROM g1.gcp_compute_firewall AS g WHERE g.allowed-\u0026gt;0-\u0026gt;\u0026#39;ports\u0026#39; ?| ARRAY[\u0026#39;3306\u0026#39;] UNION ALL SELECT g.name , SPLIT_PART(g.network, \u0026#39;/\u0026#39;, -1) AS vpc , g.source_ranges , g.target_tags FROM g2.gcp_compute_firewall AS g WHERE g.allowed-\u0026gt;0-\u0026gt;\u0026#39;ports\u0026#39; ?| ARRAY[\u0026#39;3306\u0026#39;] ) SELECT g.name , g.vpc , g.source_ranges , g.target_tags FROM g WHERE g.source_ranges ?| ( SELECT ARRAY_AGG(TEXT(a.cidr_block)) FROM aws.aws_vpc_subnet AS a WHERE a.title LIKE \u0026#39;%private%\u0026#39; ) Result Summary #èªªä¾†æ…šæ„§ï¼Œé›–ç„¶æ˜¯å¤šå¹´çš„ DBAï¼Œ\nä¸éå¤§å¤šä»¥ MySQL ç‚ºä¸»ï¼Œ\né‡åˆ° PostgreSQL æ™‚ï¼Œ\né›–ç„¶ SQL å¤§å¤šå¤§åŒå°ç•°ï¼Œ\nåœ¨ JSON ä»¥åŠ INET çš„è™•ç†æ™‚ï¼Œ\né‚„æ˜¯éœ€è¦ç¿»ä¸€ä¸‹å®˜æ–¹ Doc æ‰¾ç”¨æ³• ğŸ˜…\nä¸é Steampipe å°æ–¼ SRE ä¾†èªªï¼Œ\nçœŸçš„å¸¶ä¾†è¨±å¤šçš„ä¾¿åˆ©æ€§ï¼Œ\nç•¢ç«Ÿ SQL å¯ä»¥èªªæ˜¯ä¸–ç•Œå…±é€šçš„èªè¨€ä¹‹ä¸€ï¼Œ\nä½ å¯ä»¥ä¸æ‡‚ä¸åŒ Vender çš„ APIï¼Œ\nä½†ä½ ä¸€å®šæ‡‚ SQL\nå°±å¦‚åŒ Steampipe æåˆ°çš„ï¼Œ\nIt should feel simple, intuitive, and familiar å®ƒéœ€è¦è®“äººè¦ºå¾—ç°¡å–®ã€ç›´è¦ºä»¥åŠå‹å–„\nSQL æ­£å¥½å°±æ˜¯ä¸€å€‹é€™éº¼è®“äººé™¶é†‰çš„å¯¦ç¾\nReference # Steampipe Documentation PostgreSQL Documentation : 9.11. Network Address Functions and Operators PostgreSQL Documentation : 9.15. JSON Functions and Operators PostgreSQL Documentation : 9.17. Array Functions and Operators PostgreSQL Documentation : 9.20. Aggregate Functions ","date":"1 December 2025","permalink":"https://yangnianli.github.io/blog/select-from-cloud-steampipe/","section":"Blog","summary":"","title":"[Steampipe] SELECT * FROM cloud ;"},{"content":"","date":null,"permalink":"https://yangnianli.github.io/categories/","section":"Categories","summary":"","title":"Categories"},{"content":"","date":null,"permalink":"https://yangnianli.github.io/categories/sre/","section":"Categories","summary":"","title":"Sre"},{"content":"","date":null,"permalink":"https://yangnianli.github.io/tags/steampipe/","section":"Tags","summary":"","title":"Steampipe"},{"content":"","date":null,"permalink":"https://yangnianli.github.io/tags/","section":"Tags","summary":"","title":"Tags"},{"content":"","date":null,"permalink":"https://yangnianli.github.io/tags/tooling/","section":"Tags","summary":"","title":"Tooling"},{"content":"","date":null,"permalink":"https://yangnianli.github.io/","section":"Yang's Blog","summary":"","title":"Yang's Blog"},{"content":" é€™æ˜¯ What Is New in MySQL 8.4 since MySQL 8.0 çš„ç³»åˆ—æ–‡ï¼Œ\næœƒé‡å°éƒ¨åˆ†æˆ‘è¦ºå¾—è·Ÿæ—¥å¸¸ç¶­é‹æœ‰é—œçš„æ›´å‹•ç‰¹åˆ¥ç ”ç©¶ï¼Œ\nå…¶é¤˜çš„å°±ç•¶æ•…äº‹æ›¸ï¼Œçœ‹éçŸ¥é“å³å¯ Introduction #Logging of the shutdown process was enhanced, with the addition of startup and shutdown messages for the MySQL server, plugins, and components. Such messages are now also logged for closing connections. These additions should facilitate troubleshooting and debugging problems, particularly in the event that the server takes an excessively long time to shut down.\nFor more information, see Section 7.4.2, \u0026ldquo;The Error Log\u0026rdquo;.\nAdditions to server startup and shutdown messages.\nAdded the following types of messages to the server startup and shutdown processes as noted in this list:\nStart and end messages for server initialization when the server is started with --initialize or --initialize-insecure; these are in addition to and distinct from those shown during normal server startup and shutdown. Start and end messages for InnoDB initialization. Start and end messages for init file execution during server initialization. Start and end messages for for execution of compiled-in statements during server initialization. Start and end mesages for crash recovery during server startup (if crash recovery occurs). Start and end messages for initialization of dynamic plugins during server startup. Start and end messages for compoenents initialization step (apparent during server startup). Messages for shutdown of replica threads, as well as graceful and forceful shutdown of connection threads, during server shutdown. Start and end messages for shutdown of plugins and components during server shutdown. Exit code (return value) information with shutdown messages during initialization or server shutdown and end) In addition, if the server was built using WITH_SYSTEMD, the server now includes every systemd message in the error log.\nä»¥ä¸Šå¼•ç”¨è‡³å®˜æ–¹åŸæ–‡\nSummary #çœ‹å®Œçš„æ„Ÿæƒ³åªæœ‰ä¸€å¥ï¼Œ\næœ‰ç”¨ï¼Œä½†ä¸å¤š ğŸ˜‚\nä¸»è¦æ˜¯åŠ å¼·äº† Error Log çš„è©³ç´°ç¨‹åº¦ï¼Œ\nåœ¨ Startup ä»¥åŠ Shutdown ç­‰éšæ®µæœ‰ç´€éŒ„æ›´è©³ç´°çš„è³‡è¨Š\nè«‹åƒè€ƒä»¥ä¸‹å·®ç•°\nStartup #MySQL 8.4 #2025-11-10T11:46:28.906838+08:00 0 [Note] [MY-013930] [Server] systemd notify: STATUS=Server startup in progress 2025-11-10T11:46:28.907406+08:00 0 [System] [MY-015015] [Server] MySQL Server - start. 2025-11-10T11:46:29.132294+08:00 0 [Warning] [MY-010097] [Server] Insecure configuration for --secure-log-path: Current value does not restrict location of generated files. Consider setting it to a valid, non-empty path. 2025-11-10T11:46:29.132341+08:00 0 [Note] [MY-013932] [Server] BuildID[sha1]=862ccd8e790deea6de418ff7f6cd35f12b7bcb65 2025-11-10T11:46:29.132346+08:00 0 [Note] [MY-010949] [Server] Basedir set to /usr/. 2025-11-10T11:46:29.132356+08:00 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.4.6-6) starting as process 14556 2025-11-10T11:46:29.140143+08:00 0 [Note] [MY-012366] [InnoDB] Using Linux native AIO 2025-11-10T11:46:29.140429+08:00 0 [Note] [MY-010747] [Server] Plugin \u0026#39;FEDERATED\u0026#39; is disabled. 2025-11-10T11:46:29.140514+08:00 0 [Note] [MY-010747] [Server] Plugin \u0026#39;ndbcluster\u0026#39; is disabled. 2025-11-10T11:46:29.140538+08:00 0 [Note] [MY-010747] [Server] Plugin \u0026#39;ndbinfo\u0026#39; is disabled. 2025-11-10T11:46:29.140555+08:00 0 [Note] [MY-010747] [Server] Plugin \u0026#39;ndb_transid_mysql_connection_map\u0026#39; is disabled. 2025-11-10T11:46:29.140636+08:00 0 [Note] [MY-010747] [Server] Plugin \u0026#39;mysql_native_password\u0026#39; is disabled. 2025-11-10T11:46:29.141921+08:00 1 [Note] [MY-013930] [Server] systemd notify: STATUS=InnoDB initialization in progress 2025-11-10T11:46:29.141982+08:00 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started. 2025-11-10T11:46:29.142017+08:00 1 [Note] [MY-013546] [InnoDB] Atomic write enabled 2025-11-10T11:46:29.142051+08:00 1 [Note] [MY-012932] [InnoDB] PUNCH HOLE support available 2025-11-10T11:46:29.142074+08:00 1 [Note] [MY-012944] [InnoDB] Uses event mutexes 2025-11-10T11:46:29.142091+08:00 1 [Note] [MY-012945] [InnoDB] GCC builtin __atomic_thread_fence() is used for memory barrier 2025-11-10T11:46:29.142108+08:00 1 [Note] [MY-012948] [InnoDB] Compressed tables use zlib 1.3.1 2025-11-10T11:46:29.145247+08:00 1 [Note] [MY-012951] [InnoDB] Using hardware accelerated crc32 and polynomial multiplication. 2025-11-10T11:46:29.145710+08:00 1 [Note] [MY-012203] [InnoDB] Directories to scan \u0026#39;./\u0026#39; 2025-11-10T11:46:29.145779+08:00 1 [Note] [MY-012204] [InnoDB] Scanning \u0026#39;./\u0026#39; 2025-11-10T11:46:29.369955+08:00 1 [Note] [MY-012208] [InnoDB] Completed space ID check of 6 files. 2025-11-10T11:46:29.371608+08:00 1 [Note] [MY-012955] [InnoDB] Initializing buffer pool, total size = 5.250000G, instances = 1, chunk size =128.000000M 2025-11-10T11:46:29.371656+08:00 1 [Note] [MY-011872] [InnoDB] Setting NUMA memory policy to MPOL_INTERLEAVE 2025-11-10T11:46:31.289344+08:00 1 [Note] [MY-011874] [InnoDB] Setting NUMA memory policy to MPOL_DEFAULT 2025-11-10T11:46:31.289467+08:00 1 [Note] [MY-012957] [InnoDB] Completed initialization of buffer pool 2025-11-10T11:46:31.325996+08:00 0 [Note] [MY-011952] [InnoDB] If the mysqld execution user is authorized, page cleaner thread priority can be changed. See the man page of setpriority(). 2025-11-10T11:46:31.358951+08:00 1 [Note] [MY-013532] [InnoDB] Using \u0026#39;./#ib_16384_0.dblwr\u0026#39; for doublewrite 2025-11-10T11:46:31.401994+08:00 1 [Note] [MY-013532] [InnoDB] Using \u0026#39;./#ib_16384_1.dblwr\u0026#39; for doublewrite 2025-11-10T11:46:31.426588+08:00 1 [Note] [MY-013566] [InnoDB] Double write buffer files: 2, --innodb-doublewrite-files=2, segments_per_file=2 2025-11-10T11:46:31.426665+08:00 1 [Note] [MY-013565] [InnoDB] Double write buffer pages per instance: 128 2025-11-10T11:46:31.426704+08:00 1 [Note] [MY-013532] [InnoDB] Using \u0026#39;./#ib_16384_0.dblwr\u0026#39; for doublewrite 2025-11-10T11:46:31.426737+08:00 1 [Note] [MY-013532] [InnoDB] Using \u0026#39;./#ib_16384_1.dblwr\u0026#39; for doublewrite 2025-11-10T11:46:31.501928+08:00 1 [Note] [MY-013883] [InnoDB] The latest found checkpoint is at lsn = 30303787 in redo log file ./#innodb_redo/#ib_redo0. 2025-11-10T11:46:31.502072+08:00 1 [Note] [MY-013086] [InnoDB] Starting to parse redo log at lsn = 30303787, whereas checkpoint_lsn = 30303787 and start_lsn = 30303744 2025-11-10T11:46:31.515397+08:00 1 [Note] [MY-013083] [InnoDB] Log background threads are being started... 2025-11-10T11:46:31.558635+08:00 1 [Note] [MY-012532] [InnoDB] Applying a batch of 0 redo log records ... 2025-11-10T11:46:31.558720+08:00 1 [Note] [MY-012535] [InnoDB] Apply batch completed! 2025-11-10T11:46:31.560227+08:00 1 [Note] [MY-013252] [InnoDB] Using undo tablespace \u0026#39;./undo_001\u0026#39;. 2025-11-10T11:46:31.581489+08:00 1 [Note] [MY-013252] [InnoDB] Using undo tablespace \u0026#39;./undo_002\u0026#39;. 2025-11-10T11:46:31.588080+08:00 1 [Note] [MY-012910] [InnoDB] Opened 2 existing undo tablespaces. 2025-11-10T11:46:31.588224+08:00 1 [Note] [MY-011980] [InnoDB] GTID recovery trx_no: 3601 2025-11-10T11:46:31.809137+08:00 1 [Note] [MY-013776] [InnoDB] Parallel initialization of rseg complete 2025-11-10T11:46:31.809229+08:00 1 [Note] [MY-013777] [InnoDB] Time taken to initialize rseg using 2 thread: 221 ms. 2025-11-10T11:46:31.809334+08:00 1 [Note] [MY-012923] [InnoDB] Creating shared tablespace for temporary tables 2025-11-10T11:46:31.810230+08:00 1 [Note] [MY-012265] [InnoDB] Setting file \u0026#39;/var/lib/mysql/ibtmp1\u0026#39; size to 12 MB. Physically writing the file full; Please wait ... 2025-11-10T11:46:31.845956+08:00 1 [Note] [MY-012266] [InnoDB] File \u0026#39;/var/lib/mysql/ibtmp1\u0026#39; size is now 12 MB. 2025-11-10T11:46:31.846143+08:00 1 [Note] [MY-013627] [InnoDB] Scanning temp tablespace dir:\u0026#39;./#innodb_temp/\u0026#39; 2025-11-10T11:46:31.865616+08:00 1 [Note] [MY-013018] [InnoDB] Created 128 and tracked 128 new rollback segment(s) in the temporary tablespace. 128 are now active. 2025-11-10T11:46:31.875582+08:00 1 [Note] [MY-012976] [InnoDB] Percona XtraDB (http://www.percona.com) 8.4.6-6 started; log sequence number 30303797 2025-11-10T11:46:31.876880+08:00 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended. 2025-11-10T11:46:31.876936+08:00 1 [Note] [MY-013930] [Server] systemd notify: STATUS=InnoDB initialization successful 2025-11-10T11:46:31.958653+08:00 1 [Note] [MY-011089] [Server] Data dictionary restarting version \u0026#39;80300\u0026#39;. 2025-11-10T11:46:32.076265+08:00 1 [Note] [MY-013930] [Server] systemd notify: STATUS=InnoDB crash recovery in progress 2025-11-10T11:46:32.102885+08:00 1 [Note] [MY-012357] [InnoDB] Reading DD tablespace files 2025-11-10T11:46:32.103635+08:00 1 [Note] [MY-012356] [InnoDB] Scanned 8 tablespaces. Validated 8. 2025-11-10T11:46:32.117174+08:00 1 [Note] [MY-013930] [Server] systemd notify: STATUS=InnoDB crash recovery successful 2025-11-10T11:46:32.130646+08:00 1 [Note] [MY-010006] [Server] Using data dictionary with version \u0026#39;80300\u0026#39;. 2025-11-10T11:46:32.131943+08:00 0 [Note] [MY-013930] [Server] systemd notify: STATUS=Initialization of dynamic plugins in progress 2025-11-10T11:46:32.140199+08:00 0 [Note] [MY-011332] [Server] Plugin mysqlx reported: \u0026#39;IPv6 is available\u0026#39; 2025-11-10T11:46:32.141815+08:00 0 [Note] [MY-011323] [Server] Plugin mysqlx reported: \u0026#39;X Plugin ready for connections. bind-address: \u0026#39;::\u0026#39; port: 33060\u0026#39; 2025-11-10T11:46:32.141868+08:00 0 [Note] [MY-011323] [Server] Plugin mysqlx reported: \u0026#39;X Plugin ready for connections. socket: \u0026#39;/var/lib/mysql/mysqlx.sock\u0026#39;\u0026#39; 2025-11-10T11:46:32.142041+08:00 0 [Note] [MY-013930] [Server] systemd notify: STATUS=Initialization of dynamic plugins successful 2025-11-10T11:46:32.191009+08:00 0 [Note] [MY-010902] [Server] Thread priority attribute setting in Resource Group SQL shall be ignored due to unsupported platform or insufficient privilege. 2025-11-10T11:46:32.194618+08:00 0 [Note] [MY-010856] [Server] Failed to open the crashed binlog file when source server is recovering it. 2025-11-10T11:46:32.203368+08:00 0 [Note] [MY-013911] [Server] Crash recovery finished in binlog engine. No attempts to commit, rollback or prepare any transactions. 2025-11-10T11:46:32.203423+08:00 0 [Note] [MY-013911] [Server] Crash recovery finished in InnoDB engine. No attempts to commit, rollback or prepare any transactions. 2025-11-10T11:46:32.205909+08:00 0 [Note] [MY-012487] [InnoDB] DDL log recovery : begin 2025-11-10T11:46:32.206890+08:00 0 [Note] [MY-012488] [InnoDB] DDL log recovery : end 2025-11-10T11:46:32.211934+08:00 0 [Note] [MY-011946] [InnoDB] Loading buffer pool(s) from /var/lib/mysql/ib_buffer_pool 2025-11-10T11:46:32.223853+08:00 0 [Note] [MY-012922] [InnoDB] Waiting for purge to start 2025-11-10T11:46:32.234168+08:00 0 [Note] [MY-011946] [InnoDB] Buffer pool(s) load completed at 251110 11:46:32 2025-11-10T11:46:32.288420+08:00 0 [Note] [MY-010303] [Server] Skipping generation of SSL certificates as options related to SSL are specified. 2025-11-10T11:46:32.289195+08:00 0 [Warning] [MY-010068] [Server] CA certificate /etc/mysql/ssl/ca-cert.pem is self signed. 2025-11-10T11:46:32.289253+08:00 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel. 2025-11-10T11:46:32.289486+08:00 0 [Note] [MY-010308] [Server] Skipping generation of RSA key pair through --sha256_password_auto_generate_rsa_keys as key files are present in data directory. 2025-11-10T11:46:32.289681+08:00 0 [Note] [MY-010307] [Server] Skipping generation of RSA key pair through --caching_sha2_password_auto_generate_rsa_keys as options related to RSA keys are specified. 2025-11-10T11:46:32.289844+08:00 0 [Note] [MY-010252] [Server] Server hostname (bind-address): \u0026#39;*\u0026#39;; port: 3306 2025-11-10T11:46:32.289911+08:00 0 [Note] [MY-010253] [Server] IPv6 is available. 2025-11-10T11:46:32.289931+08:00 0 [Note] [MY-010264] [Server] - \u0026#39;::\u0026#39; resolves to \u0026#39;::\u0026#39;; 2025-11-10T11:46:32.289955+08:00 0 [Note] [MY-010251] [Server] Server socket created on IP: \u0026#39;::\u0026#39;. 2025-11-10T11:46:32.291909+08:00 0 [Note] [MY-013930] [Server] systemd notify: STATUS=Components initialization in progress 2025-11-10T11:46:32.292734+08:00 0 [Note] [MY-013930] [Server] systemd notify: STATUS=Components initialization successful 2025-11-10T11:46:32.324976+08:00 0 [Note] [MY-011025] [Repl] Failed to start replica threads for channel \u0026#39;\u0026#39;. 2025-11-10T11:46:32.328585+08:00 6 [Note] [MY-010051] [Server] Event Scheduler: scheduler thread started with id 6 2025-11-10T11:46:32.328860+08:00 0 [Note] [MY-011240] [Server] Plugin mysqlx reported: \u0026#39;Using SSL configuration from MySQL Server\u0026#39; 2025-11-10T11:46:32.329288+08:00 0 [Note] [MY-011243] [Server] Plugin mysqlx reported: \u0026#39;Using OpenSSL for TLS connections\u0026#39; 2025-11-10T11:46:32.329498+08:00 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: \u0026#39;8.4.6-6\u0026#39; socket: \u0026#39;/var/lib/mysql/mysql.sock\u0026#39; port: 3306 Percona Server (GPL), Release 6, Revision 9927a2fb. 2025-11-10T11:46:32.329500+08:00 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: \u0026#39;::\u0026#39; port: 33060, socket: /var/lib/mysql/mysqlx.sock 2025-11-10T11:46:32.330079+08:00 0 [Note] [MY-013930] [Server] systemd notify: READY=1 STATUS=Server is operational MAIN_PID=14556 MySQL 8.0 #2025-11-10T13:59:10.992215+08:00 0 [Warning] [MY-010097] [Server] Insecure configuration for --secure-log-path: Current value does not restrict location of generated files. Consider setting it to a valid, non-empty path. 2025-11-10T13:59:10.992267+08:00 0 [Warning] [MY-010918] [Server] \u0026#39;default_authentication_plugin\u0026#39; is deprecated and will be removed in a future release. Please use authentication_policy instead. 2025-11-10T13:59:10.992270+08:00 0 [Note] [MY-013932] [Server] BuildID[sha1]=828db7db80124cd9a47f09b8a4a6dc29ead7ca38 2025-11-10T13:59:10.992277+08:00 0 [Note] [MY-010949] [Server] Basedir set to /usr/. 2025-11-10T13:59:10.992284+08:00 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.0.33-25) starting as process 5191 2025-11-10T13:59:10.996222+08:00 0 [Note] [MY-012366] [InnoDB] Using Linux native AIO 2025-11-10T13:59:10.996308+08:00 0 [Warning] [MY-012367] [InnoDB] Option innodb_dedicated_server is ignored for innodb_flush_methodbecause innodb_flush_method=O_DIRECT is specified explicitly. 2025-11-10T13:59:10.996328+08:00 0 [Warning] [MY-012358] [InnoDB] Option innodb_dedicated_server is ignored for innodb_buffer_pool_size because innodb_buffer_pool_size=3221225472 is specified explicitly. 2025-11-10T13:59:10.996463+08:00 0 [Note] [MY-010747] [Server] Plugin \u0026#39;FEDERATED\u0026#39; is disabled. 2025-11-10T13:59:10.996528+08:00 0 [Note] [MY-010747] [Server] Plugin \u0026#39;ndbcluster\u0026#39; is disabled. 2025-11-10T13:59:10.996545+08:00 0 [Note] [MY-010747] [Server] Plugin \u0026#39;ndbinfo\u0026#39; is disabled. 2025-11-10T13:59:10.996553+08:00 0 [Note] [MY-010747] [Server] Plugin \u0026#39;ndb_transid_mysql_connection_map\u0026#39; is disabled. 2025-11-10T13:59:10.997768+08:00 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started. 2025-11-10T13:59:10.997827+08:00 1 [Note] [MY-013547] [InnoDB] Atomic write disabled 2025-11-10T13:59:10.997860+08:00 1 [Note] [MY-012932] [InnoDB] PUNCH HOLE support available 2025-11-10T13:59:10.997879+08:00 1 [Note] [MY-012944] [InnoDB] Uses event mutexes 2025-11-10T13:59:10.997886+08:00 1 [Note] [MY-012945] [InnoDB] GCC builtin __atomic_thread_fence() is used for memory barrier 2025-11-10T13:59:10.997900+08:00 1 [Note] [MY-012948] [InnoDB] Compressed tables use zlib 1.2.13 2025-11-10T13:59:11.000847+08:00 1 [Note] [MY-012951] [InnoDB] Using hardware accelerated crc32 and polynomial multiplication. 2025-11-10T13:59:11.001216+08:00 1 [Note] [MY-012203] [InnoDB] Directories to scan \u0026#39;./\u0026#39; 2025-11-10T13:59:11.001259+08:00 1 [Note] [MY-012204] [InnoDB] Scanning \u0026#39;./\u0026#39; 2025-11-10T13:59:11.041387+08:00 1 [Note] [MY-012208] [InnoDB] Completed space ID check of 5 files. 2025-11-10T13:59:11.042588+08:00 1 [Note] [MY-012955] [InnoDB] Initializing buffer pool, total size = 3.000000G, instances = 2, chunk size =128.000000M 2025-11-10T13:59:11.128997+08:00 1 [Note] [MY-012957] [InnoDB] Completed initialization of buffer pool 2025-11-10T13:59:11.164980+08:00 0 [Note] [MY-011952] [InnoDB] If the mysqld execution user is authorized, page cleaner and LRU manager thread priority can be changed. See the man page of setpriority(). 2025-11-10T13:59:11.279900+08:00 1 [Note] [MY-013883] [InnoDB] The latest found checkpoint is at lsn = 32109818 in redo log file ./#innodb_redo/#ib_redo0. 2025-11-10T13:59:11.279993+08:00 1 [Note] [MY-013086] [InnoDB] Starting to parse redo log at lsn = 32109600, whereas checkpoint_lsn = 32109818 and start_lsn = 32109568 2025-11-10T13:59:11.311059+08:00 1 [Note] [MY-013083] [InnoDB] Log background threads are being started... 2025-11-10T13:59:11.416434+08:00 1 [Note] [MY-012532] [InnoDB] Applying a batch of 0 redo log records ... 2025-11-10T13:59:11.416495+08:00 1 [Note] [MY-012535] [InnoDB] Apply batch completed! 2025-11-10T13:59:11.417728+08:00 1 [Note] [MY-013252] [InnoDB] Using undo tablespace \u0026#39;./undo_001\u0026#39;. 2025-11-10T13:59:11.444628+08:00 1 [Note] [MY-013252] [InnoDB] Using undo tablespace \u0026#39;./undo_002\u0026#39;. 2025-11-10T13:59:11.450696+08:00 1 [Note] [MY-012910] [InnoDB] Opened 2 existing undo tablespaces. 2025-11-10T13:59:11.450745+08:00 1 [Note] [MY-011980] [InnoDB] GTID recovery trx_no: 2065 2025-11-10T13:59:12.022381+08:00 1 [Note] [MY-013776] [InnoDB] Parallel initialization of rseg complete 2025-11-10T13:59:12.022448+08:00 1 [Note] [MY-013777] [InnoDB] Time taken to initialize rseg using 2 thread: 571710 ms. 2025-11-10T13:59:12.022538+08:00 1 [Note] [MY-012923] [InnoDB] Creating shared tablespace for temporary tables 2025-11-10T13:59:12.022640+08:00 1 [Note] [MY-012265] [InnoDB] Setting file \u0026#39;/var/lib/mysql/ibtmp1\u0026#39; size to 12 MB. Physically writing the file full; Please wait ... 2025-11-10T13:59:12.057665+08:00 1 [Note] [MY-012266] [InnoDB] File \u0026#39;/var/lib/mysql/ibtmp1\u0026#39; size is now 12 MB. 2025-11-10T13:59:12.057770+08:00 1 [Note] [MY-013627] [InnoDB] Scanning temp tablespace dir:\u0026#39;./#innodb_temp/\u0026#39; 2025-11-10T13:59:12.069806+08:00 1 [Note] [MY-013018] [InnoDB] Created 128 and tracked 128 new rollback segment(s) in the temporary tablespace. 128 are now active. 2025-11-10T13:59:12.077433+08:00 1 [Note] [MY-012976] [InnoDB] Percona XtraDB (http://www.percona.com) 8.0.33-25 started; log sequence number 32109828 2025-11-10T13:59:12.078046+08:00 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended. 2025-11-10T13:59:12.086557+08:00 1 [Note] [MY-011089] [Server] Data dictionary restarting version \u0026#39;80023\u0026#39;. 2025-11-10T13:59:12.281069+08:00 1 [Note] [MY-012357] [InnoDB] Reading DD tablespace files 2025-11-10T13:59:12.281617+08:00 1 [Note] [MY-012356] [InnoDB] Scanned 7 tablespaces. Validated 7. 2025-11-10T13:59:12.302157+08:00 1 [Note] [MY-010006] [Server] Using data dictionary with version \u0026#39;80023\u0026#39;. 2025-11-10T13:59:12.308733+08:00 0 [Note] [MY-011332] [Server] Plugin mysqlx reported: \u0026#39;IPv6 is available\u0026#39; 2025-11-10T13:59:12.309917+08:00 0 [Note] [MY-011323] [Server] Plugin mysqlx reported: \u0026#39;X Plugin ready for connections. bind-address: \u0026#39;::\u0026#39; port: 33060\u0026#39; 2025-11-10T13:59:12.309944+08:00 0 [Note] [MY-011323] [Server] Plugin mysqlx reported: \u0026#39;X Plugin ready for connections. socket: \u0026#39;/var/lib/mysql/mysqlx.sock\u0026#39;\u0026#39; 2025-11-10T13:59:12.330315+08:00 0 [Note] [MY-010902] [Server] Thread priority attribute setting in Resource Group SQL shall be ignored due to unsupported platform or insufficient privilege. 2025-11-10T13:59:12.334603+08:00 0 [Note] [MY-010856] [Server] Failed to open the crashed binlog file when source server is recovering it. 2025-11-10T13:59:12.343184+08:00 0 [Note] [MY-013911] [Server] Crash recovery finished in binlog engine. No attempts to commit, rollback or prepare any transactions. 2025-11-10T13:59:12.343214+08:00 0 [Note] [MY-013911] [Server] Crash recovery finished in InnoDB engine. No attempts to commit, rollback or prepare any transactions. 2025-11-10T13:59:12.345475+08:00 0 [Note] [MY-012487] [InnoDB] DDL log recovery : begin 2025-11-10T13:59:12.346228+08:00 0 [Note] [MY-012488] [InnoDB] DDL log recovery : end 2025-11-10T13:59:12.350893+08:00 0 [Note] [MY-011946] [InnoDB] Loading buffer pool(s) from /var/lib/mysql/ib_buffer_pool 2025-11-10T13:59:12.351226+08:00 0 [Note] [MY-011946] [InnoDB] Buffer pool(s) load completed at 251110 13:59:12 2025-11-10T13:59:12.375527+08:00 0 [Note] [MY-010303] [Server] Skipping generation of SSL certificates as options related to SSL are specified. 2025-11-10T13:59:12.376332+08:00 0 [Warning] [MY-010068] [Server] CA certificate /etc/mysql/ssl/ca-cert.pem is self signed. 2025-11-10T13:59:12.376367+08:00 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel. 2025-11-10T13:59:12.376552+08:00 0 [Note] [MY-010308] [Server] Skipping generation of RSA key pair through --sha256_password_auto_generate_rsa_keys as key files are present in data directory. 2025-11-10T13:59:12.376710+08:00 0 [Note] [MY-010308] [Server] Skipping generation of RSA key pair through --caching_sha2_password_auto_generate_rsa_keys as key files are present in data directory. 2025-11-10T13:59:12.376832+08:00 0 [Note] [MY-010252] [Server] Server hostname (bind-address): \u0026#39;*\u0026#39;; port: 3306 2025-11-10T13:59:12.376879+08:00 0 [Note] [MY-010253] [Server] IPv6 is available. 2025-11-10T13:59:12.376894+08:00 0 [Note] [MY-010264] [Server] - \u0026#39;::\u0026#39; resolves to \u0026#39;::\u0026#39;; 2025-11-10T13:59:12.376909+08:00 0 [Note] [MY-010251] [Server] Server socket created on IP: \u0026#39;::\u0026#39;. 2025-11-10T13:59:12.411001+08:00 0 [Note] [MY-011025] [Repl] Failed to start replica threads for channel \u0026#39;\u0026#39;. 2025-11-10T13:59:12.414065+08:00 5 [Note] [MY-010051] [Server] Event Scheduler: scheduler thread started with id 5 2025-11-10T13:59:12.414293+08:00 0 [Note] [MY-011240] [Server] Plugin mysqlx reported: \u0026#39;Using SSL configuration from MySQL Server\u0026#39; 2025-11-10T13:59:12.414852+08:00 0 [Note] [MY-011243] [Server] Plugin mysqlx reported: \u0026#39;Using OpenSSL for TLS connections\u0026#39; 2025-11-10T13:59:12.415018+08:00 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: \u0026#39;8.0.33-25\u0026#39; socket: \u0026#39;/var/lib/mysql/mysql.sock\u0026#39; port: 3306 Percona Server (GPL), Release 25, Revision 60c9e2c5. 2025-11-10T13:59:12.418069+08:00 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: \u0026#39;::\u0026#39; port: 33060, socket: /var/lib/mysql/mysqlx.sock å·®ç•°é» # # MySQL 8.4 [Server] systemd notify: STATUS=InnoDB initialization successful [Server] Data dictionary restarting version \u0026#39;80300\u0026#39;. [Server] systemd notify: STATUS=InnoDB crash recovery in progress [InnoDB] Reading DD tablespace files [InnoDB] Scanned 8 tablespaces. Validated 8. [Server] systemd notify: STATUS=InnoDB crash recovery successful # MySQL 8.0 [Server] Data dictionary restarting version \u0026#39;80023\u0026#39;. [InnoDB] Reading DD tablespace files [InnoDB] Scanned 7 tablespaces. Validated 7. é¡ä¼¼ä¸Šè¿°é€™æ¨£ï¼Œå¤šäº†ä¸€äº› [Server] Status\nåœ¨å‡ºç¾å•é¡Œæ™‚ï¼Œå¯ä»¥æ›´åŠ æ˜ç¢ºçš„çŸ¥é“æ˜¯åœ¨å“ªä¸€æ­¥é©Ÿå‡ºç¾éŒ¯èª¤\nShutdown #MySQL 8.4 #2025-11-10T11:46:24.969675+08:00 0 [System] [MY-013172] [Server] Received SHUTDOWN from user \u0026lt;via user signal\u0026gt;. Shutting down mysqld (Version: 8.4.6-6). 2025-11-10T11:46:24.970821+08:00 0 [Note] [MY-013930] [Server] systemd notify: STOPPING=1 STATUS=Server shutdown in progress 2025-11-10T11:46:24.975792+08:00 0 [Note] [MY-015023] [Server] MySQL Server: Closing Connections - start. 2025-11-10T11:46:24.975924+08:00 0 [Note] [MY-013930] [Server] systemd notify: STATUS=Graceful shutdown of connections in progress 2025-11-10T11:46:24.976468+08:00 0 [Note] [MY-010067] [Server] Giving 3 client threads a chance to die gracefully 2025-11-10T11:46:24.976524+08:00 0 [Note] [MY-010117] [Server] Shutting down replica threads 2025-11-10T11:46:24.976551+08:00 0 [Note] [MY-013930] [Server] systemd notify: STATUS=Shutdown of replica threads in progress 2025-11-10T11:46:24.976579+08:00 0 [Note] [MY-010054] [Server] Event Scheduler: Killing the scheduler thread, thread id 6 2025-11-10T11:46:24.976603+08:00 0 [Note] [MY-010050] [Server] Event Scheduler: Waiting for the scheduler thread to reply 2025-11-10T11:46:24.976929+08:00 0 [Note] [MY-010048] [Server] Event Scheduler: Stopped 2025-11-10T11:46:26.977108+08:00 0 [Note] [MY-010118] [Server] Forcefully disconnecting 1 remaining clients 2025-11-10T11:46:26.977241+08:00 0 [Note] [MY-013930] [Server] systemd notify: STATUS=Forceful shutdown of connections in progress 2025-11-10T11:46:26.977279+08:00 0 [Warning] [MY-010909] [Server] /usr/sbin/mysqld: Forcing close of thread 927 user: \u0026#39;xxxxx\u0026#39;. 2025-11-10T11:46:26.977406+08:00 0 [Note] [MY-010043] [Server] Event Scheduler: Purging the queue. 0 events 2025-11-10T11:46:26.977441+08:00 0 [Note] [MY-015026] [Server] Waiting for forceful disconnection of 1 thread(s) to end. 2025-11-10T11:46:26.977469+08:00 0 [Note] [MY-014072] [Server] Waiting for THDs in partition 7 to be closed, 1 still left. 1 THDs left in total for all partitions. 2025-11-10T11:46:26.978294+08:00 0 [Note] [MY-015024] [Server] MySQL Server: Closing Connections - end. 2025-11-10T11:46:26.978349+08:00 0 [Note] [MY-013930] [Server] systemd notify: STATUS=Connection shutdown complete 2025-11-10T11:46:26.978491+08:00 0 [Note] [MY-013930] [Server] systemd notify: STATUS=Pre DD shutdown of MySQL SE plugin InnoDB in progress 2025-11-10T11:46:26.979665+08:00 0 [Note] [MY-012330] [InnoDB] FTS optimize thread exiting. 2025-11-10T11:46:27.829786+08:00 0 [Note] [MY-013930] [Server] systemd notify: STATUS=Pre DD shutdown of MySQL SE plugin InnoDB completed 2025-11-10T11:46:27.831654+08:00 0 [Note] [MY-010120] [Server] Binlog end 2025-11-10T11:46:27.834907+08:00 0 [Note] [MY-015019] [Server] MySQL Server: Plugins Shutdown - start. 2025-11-10T11:46:27.834976+08:00 0 [Note] [MY-013930] [Server] systemd notify: STATUS=Shutdown of plugins in progress 2025-11-10T11:46:27.835010+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;mysqlx\u0026#39; 2025-11-10T11:46:27.836708+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;mysqlx_cache_cleaner\u0026#39; 2025-11-10T11:46:27.836771+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;ngram\u0026#39; 2025-11-10T11:46:27.836796+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;BLACKHOLE\u0026#39; 2025-11-10T11:46:27.836839+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;ARCHIVE\u0026#39; 2025-11-10T11:46:27.836857+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;TempTable\u0026#39; 2025-11-10T11:46:27.836874+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;MRG_MYISAM\u0026#39; 2025-11-10T11:46:27.836892+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;MyISAM\u0026#39; 2025-11-10T11:46:27.836919+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_SESSION_TEMP_TABLESPACES\u0026#39; 2025-11-10T11:46:27.836938+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_CACHED_INDEXES\u0026#39; 2025-11-10T11:46:27.836955+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_VIRTUAL\u0026#39; 2025-11-10T11:46:27.836974+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_COLUMNS\u0026#39; 2025-11-10T11:46:27.836992+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_TABLESPACES\u0026#39; 2025-11-10T11:46:27.837012+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_INDEXES\u0026#39; 2025-11-10T11:46:27.837030+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_TABLESTATS\u0026#39; 2025-11-10T11:46:27.837052+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_TABLES\u0026#39; 2025-11-10T11:46:27.837070+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_FT_INDEX_TABLE\u0026#39; 2025-11-10T11:46:27.837086+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_FT_INDEX_CACHE\u0026#39; 2025-11-10T11:46:27.837103+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_FT_CONFIG\u0026#39; 2025-11-10T11:46:27.837120+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_FT_BEING_DELETED\u0026#39; 2025-11-10T11:46:27.837137+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_FT_DELETED\u0026#39; 2025-11-10T11:46:27.837154+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_FT_DEFAULT_STOPWORD\u0026#39; 2025-11-10T11:46:27.837170+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_METRICS\u0026#39; 2025-11-10T11:46:27.837189+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_TEMP_TABLE_INFO\u0026#39; 2025-11-10T11:46:27.837207+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_BUFFER_POOL_STATS\u0026#39; 2025-11-10T11:46:27.837224+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_BUFFER_PAGE_LRU\u0026#39; 2025-11-10T11:46:27.837241+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_BUFFER_PAGE\u0026#39; 2025-11-10T11:46:27.837260+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_CMP_PER_INDEX_RESET\u0026#39; 2025-11-10T11:46:27.837278+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_CMP_PER_INDEX\u0026#39; 2025-11-10T11:46:27.837295+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_CMPMEM_RESET\u0026#39; 2025-11-10T11:46:27.837312+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_CMPMEM\u0026#39; 2025-11-10T11:46:27.837329+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_CMP_RESET\u0026#39; 2025-11-10T11:46:27.837345+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_CMP\u0026#39; 2025-11-10T11:46:27.837362+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_TRX\u0026#39; 2025-11-10T11:46:27.837383+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;InnoDB\u0026#39; 2025-11-10T11:46:27.837426+08:00 0 [Note] [MY-013072] [InnoDB] Starting shutdown... 2025-11-10T11:46:27.837574+08:00 0 [Note] [MY-011944] [InnoDB] Dumping buffer pool(s) to /var/lib/mysql/ib_buffer_pool 2025-11-10T11:46:27.837859+08:00 0 [Note] [MY-011944] [InnoDB] Buffer pool(s) dump completed at 251110 11:46:27 2025-11-10T11:46:27.841758+08:00 0 [Note] [MY-013084] [InnoDB] Log background threads are being closed... 2025-11-10T11:46:28.766453+08:00 0 [Note] [MY-013854] [InnoDB] Bytes written to disk by DBLWR (ON): 819200 2025-11-10T11:46:28.767553+08:00 0 [Note] [MY-012980] [InnoDB] Shutdown completed; log sequence number 30303787 2025-11-10T11:46:28.768904+08:00 0 [Note] [MY-012255] [InnoDB] Removed temporary tablespace data file: \u0026#34;ibtmp1\u0026#34; 2025-11-10T11:46:28.768969+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;MEMORY\u0026#39; 2025-11-10T11:46:28.768999+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;CSV\u0026#39; 2025-11-10T11:46:28.769022+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;PERFORMANCE_SCHEMA\u0026#39; 2025-11-10T11:46:28.769062+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;daemon_keyring_proxy_plugin\u0026#39; 2025-11-10T11:46:28.769092+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;sha2_cache_cleaner\u0026#39; 2025-11-10T11:46:28.769114+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;caching_sha2_password\u0026#39; 2025-11-10T11:46:28.769135+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;sha256_password\u0026#39; 2025-11-10T11:46:28.769285+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;binlog\u0026#39; 2025-11-10T11:46:28.769312+08:00 0 [Note] [MY-015020] [Server] MySQL Server: Plugins Shutdown - end. 2025-11-10T11:46:28.769337+08:00 0 [Note] [MY-013930] [Server] systemd notify: STATUS=Shutdown of plugins complete 2025-11-10T11:46:28.773283+08:00 0 [Note] [MY-015021] [Server] MySQL Server: Components Shutdown - start. 2025-11-10T11:46:28.773313+08:00 0 [Note] [MY-013930] [Server] systemd notify: Shutdown of components in progress 2025-11-10T11:46:28.773922+08:00 0 [Note] [MY-015022] [Server] MySQL Server: Components Shutdown - end (with return value = 0). 2025-11-10T11:46:28.773944+08:00 0 [Note] [MY-013930] [Server] systemd notify: Shutdown of components successful 2025-11-10T11:46:28.774059+08:00 0 [Note] [MY-013930] [Server] systemd notify: STATUS=Server shutdown complete (with return value = 0) 2025-11-10T11:46:28.774075+08:00 0 [System] [MY-010910] [Server] /usr/sbin/mysqld: Shutdown complete (mysqld 8.4.6-6) Percona Server (GPL), Release 6, Revision 9927a2fb. 2025-11-10T11:46:28.774082+08:00 0 [System] [MY-015016] [Server] MySQL Server - end. MySQL 8.0 #2025-11-10T13:59:07.831656+08:00 0 [System] [MY-013172] [Server] Received SHUTDOWN from user \u0026lt;via user signal\u0026gt;. Shutting down mysqld (Version: 8.0.33-25). 2025-11-10T13:59:07.834106+08:00 0 [Note] [MY-010067] [Server] Giving 2 client threads a chance to die gracefully 2025-11-10T13:59:07.834134+08:00 0 [Note] [MY-010117] [Server] Shutting down replica threads 2025-11-10T13:59:07.834147+08:00 0 [Note] [MY-010054] [Server] Event Scheduler: Killing the scheduler thread, thread id 5 2025-11-10T13:59:07.834161+08:00 0 [Note] [MY-010050] [Server] Event Scheduler: Waiting for the scheduler thread to reply 2025-11-10T13:59:07.834235+08:00 0 [Note] [MY-010048] [Server] Event Scheduler: Stopped 2025-11-10T13:59:09.834325+08:00 0 [Note] [MY-010118] [Server] Forcefully disconnecting 0 remaining clients 2025-11-10T13:59:09.834389+08:00 0 [Note] [MY-010043] [Server] Event Scheduler: Purging the queue. 0 events 2025-11-10T13:59:09.835670+08:00 0 [Note] [MY-012330] [InnoDB] FTS optimize thread exiting. 2025-11-10T13:59:09.939724+08:00 0 [Note] [MY-010120] [Server] Binlog end 2025-11-10T13:59:09.941776+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;mysqlx\u0026#39; 2025-11-10T13:59:09.942705+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;mysqlx_cache_cleaner\u0026#39; 2025-11-10T13:59:09.942734+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;ngram\u0026#39; 2025-11-10T13:59:09.942743+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;BLACKHOLE\u0026#39; 2025-11-10T13:59:09.942750+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;ARCHIVE\u0026#39; 2025-11-10T13:59:09.942757+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;TempTable\u0026#39; 2025-11-10T13:59:09.942762+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;MRG_MYISAM\u0026#39; 2025-11-10T13:59:09.942769+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;MyISAM\u0026#39; 2025-11-10T13:59:09.942787+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_SESSION_TEMP_TABLESPACES\u0026#39; 2025-11-10T13:59:09.942836+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_CACHED_INDEXES\u0026#39; 2025-11-10T13:59:09.942846+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_VIRTUAL\u0026#39; 2025-11-10T13:59:09.942853+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_COLUMNS\u0026#39; 2025-11-10T13:59:09.942859+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_TABLESPACES\u0026#39; 2025-11-10T13:59:09.942865+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_INDEXES\u0026#39; 2025-11-10T13:59:09.942871+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_TABLESTATS\u0026#39; 2025-11-10T13:59:09.942877+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_TABLES\u0026#39; 2025-11-10T13:59:09.942890+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_FT_INDEX_TABLE\u0026#39; 2025-11-10T13:59:09.942897+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_FT_INDEX_CACHE\u0026#39; 2025-11-10T13:59:09.942904+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_FT_CONFIG\u0026#39; 2025-11-10T13:59:09.942910+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_FT_BEING_DELETED\u0026#39; 2025-11-10T13:59:09.942916+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_FT_DELETED\u0026#39; 2025-11-10T13:59:09.942924+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_FT_DEFAULT_STOPWORD\u0026#39; 2025-11-10T13:59:09.942938+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_METRICS\u0026#39; 2025-11-10T13:59:09.942945+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_TEMP_TABLE_INFO\u0026#39; 2025-11-10T13:59:09.942951+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_BUFFER_POOL_STATS\u0026#39; 2025-11-10T13:59:09.942957+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_BUFFER_PAGE_LRU\u0026#39; 2025-11-10T13:59:09.942962+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_BUFFER_PAGE\u0026#39; 2025-11-10T13:59:09.942969+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_CMP_PER_INDEX_RESET\u0026#39; 2025-11-10T13:59:09.942975+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_CMP_PER_INDEX\u0026#39; 2025-11-10T13:59:09.942981+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_CMPMEM_RESET\u0026#39; 2025-11-10T13:59:09.942990+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_CMPMEM\u0026#39; 2025-11-10T13:59:09.942998+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_CMP_RESET\u0026#39; 2025-11-10T13:59:09.943005+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_CMP\u0026#39; 2025-11-10T13:59:09.943011+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;INNODB_TRX\u0026#39; 2025-11-10T13:59:09.943017+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;InnoDB\u0026#39; 2025-11-10T13:59:09.943044+08:00 0 [Note] [MY-013072] [InnoDB] Starting shutdown... 2025-11-10T13:59:09.943151+08:00 0 [Note] [MY-011944] [InnoDB] Dumping buffer pool(s) to /var/lib/mysql/ib_buffer_pool 2025-11-10T13:59:09.943401+08:00 0 [Note] [MY-011944] [InnoDB] Buffer pool(s) dump completed at 251110 13:59:09 2025-11-10T13:59:10.149053+08:00 0 [Note] [MY-013084] [InnoDB] Log background threads are being closed... 2025-11-10T13:59:10.666371+08:00 0 [Note] [MY-012980] [InnoDB] Shutdown completed; log sequence number 32109818 2025-11-10T13:59:10.666498+08:00 0 [Note] [MY-012255] [InnoDB] Removed temporary tablespace data file: \u0026#34;ibtmp1\u0026#34; 2025-11-10T13:59:10.666528+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;MEMORY\u0026#39; 2025-11-10T13:59:10.666541+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;CSV\u0026#39; 2025-11-10T13:59:10.666551+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;PERFORMANCE_SCHEMA\u0026#39; 2025-11-10T13:59:10.666577+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;daemon_keyring_proxy_plugin\u0026#39; 2025-11-10T13:59:10.666592+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;sha2_cache_cleaner\u0026#39; 2025-11-10T13:59:10.666602+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;caching_sha2_password\u0026#39; 2025-11-10T13:59:10.666612+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;sha256_password\u0026#39; 2025-11-10T13:59:10.666618+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;mysql_native_password\u0026#39; 2025-11-10T13:59:10.666748+08:00 0 [Note] [MY-010733] [Server] Shutting down plugin \u0026#39;binlog\u0026#39; 2025-11-10T13:59:10.667428+08:00 0 [System] [MY-010910] [Server] /usr/sbin/mysqld: Shutdown complete (mysqld 8.0.33-25) Percona Server (GPL), Release 25, Revision 60c9e2c5. å·®ç•°é» # # MySQL 8.4 [Warning] [MY-010909] [Server] /usr/sbin/mysqld: Forcing close of thread 927 user: \u0026#39;xxxxx\u0026#39;. # MySQL 8.0 None è·Ÿ Startup é¡ä¼¼ï¼Œä¹Ÿæ˜¯å¤šäº†ä¸€äº› [Server Status]\næ¯”è¼ƒç‰¹åˆ¥ä¸”æœ‰ç”¨çš„åœ°æ–¹åœ¨æ–¼ï¼ŒShutdown æœ‰å¤šäº†é€£ç·šè¢«é—œé–‰çš„è³‡è¨Šï¼Œ\né€™åœ¨æ’æŸ¥ä¸€äº›å•é¡Œæˆ–è¨±å¯ä»¥å¸¶ä¾†ä¸€äº›å¹«åŠ©ã€‚\næ¯”å¦‚èªªæœ‰ Client åæ‡‰é€£ç·šå‡ºç¾éŒ¯èª¤ï¼Œä½†æ˜æ˜å·²ç¶“å¾ Connection Pool ä¸­ç§»é™¤äº†ï¼Œ\nç•¶ä¸‹ä¹Ÿåªæœ‰æŠŠæ©Ÿå™¨é‡å•Ÿï¼Œé€™æ™‚å°±å¯ä»¥çœ‹çœ‹ Error Log ä¸­æ˜¯ä¸æ˜¯æœ‰é€£ç·šæ²’æœ‰ç§»é™¤ä¹¾æ·¨ï¼Œ\nå°è‡´é€£ç·šé‚„æ˜¯è¢«é€åˆ°é€™å°æ©Ÿå™¨è€Œå½±éŸ¿åˆ°\nAfterword #ç•¶åˆæ¨™è¨˜ç‚º â­ çš„åŸå› æ˜¯æƒ³äº†è§£ filter ä»¥åŠ sink çš„åŠŸèƒ½ï¼Œ\nå¾Œä¾†ç™¼ç¾é€™å…¶å¯¦åœ¨ MySQL 8.0 å°±å·²ç¶“æœ‰äº†\nWL #9323 -\u0026gt; Logging services: Improved error logging in 8.0\nMySQL 8.0 Release Note: Error logging was rewritten to use the MySQL component architecture\nç•¶åˆ MySQL 8.0 æ™‚æ²’æœ‰ç•™æ„åˆ°é€™åŠŸèƒ½ï¼Œ\nåˆ°äº† MySQL 8.4 æ™‚æ‰ä¾†ç†Ÿæ‚‰å®ƒï¼Œ\nä¹Ÿå› ç‚ºé€™åŠŸèƒ½è·Ÿ 8.4 æ²’æœ‰å¤ªå¤§é—œä¿‚ï¼Œ\næ‰€ä»¥çœ‹å®Œå¾Œå°±é»˜é»˜åœ°æŠŠå®ƒç§»é™¤ â­ å›‰ã€‚\næ„Ÿæƒ³é›–ç„¶æ˜¯ æœ‰ç”¨ï¼Œä½†ä¸å¤š\nä¸»è¦çš„åŸå› æ˜¯å› ç‚ºæˆ‘å€‘å¤ªæ™šçŸ¥é“é€™åŠŸèƒ½ï¼Œ\næˆ‘å€‘ç›®å‰æ˜¯ä½¿ç”¨ Loki çš„æ–¹å¼ä¾†æ”¶ Error Logï¼Œ\nå¦‚æœæ—©é»çŸ¥é“é€™åŠŸèƒ½çš„è©±ï¼Œ\nç•¶åˆçš„æ±ºç­–å°±æœƒæ˜¯ä½¿ç”¨ log_sink_json çš„æ–¹å¼ä¾†å„²å­˜ Error Logï¼Œ\né€™å°å¾Œé¢çš„ç³»çµ±ä¸²æ¥å¯ä»¥å¸¶ä¾†å¾ˆå¤§çš„ä¾¿åˆ©æ€§ã€‚\nç›®å‰æ˜¯ä½¿ç”¨ LogQL å­—ä¸²æ¯”å°çš„æ–¹å¼ä¾†åµæ¸¬ä¸¦ç™¼é€å‘Šè­¦ï¼Œ\nå‘Šè­¦çš„ç¨®é¡ç›®å‰æœ‰ä»¥ä¸‹å¹¾ç¨®\nToo Many Connections Dead Lock ERROR Log Too Many Connection # Loki expr: count_over_time({type=\u0026ldquo;mysql/errorlog\u0026rdquo;} |= \u0026ldquo;Too many connections\u0026rdquo; [1m])\nå‡å¦‚ä½¿ç”¨ log_sink_json çš„è©±ï¼ŒError Log çš„è³‡è¨Šå¦‚ä¸‹\n{ \u0026#34;prio\u0026#34;: 2, \u0026#34;source_line\u0026#34;: 282, \u0026#34;source_file\u0026#34;: \u0026#34;connection_handler_manager.cc\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;Too many connections\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2025-11-10T09:39:22.188365+08:00\u0026#34;, \u0026#34;ts\u0026#34;: 1762738762188, \u0026#34;subsystem\u0026#34;: \u0026#34;Server\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;Warning\u0026#34; } Dead Lock # Loki expr: count_over_time({type=\u0026ldquo;mysql/errorlog\u0026rdquo;} |= \u0026ldquo;deadlock\u0026rdquo; [1m])\nlog_sink_json æ ¼å¼\n{ \u0026#34;log_type\u0026#34;: 1, \u0026#34;prio\u0026#34;: 3, \u0026#34;err_code\u0026#34;: 12468, \u0026#34;subsystem\u0026#34;: \u0026#34;InnoDB\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;Transactions deadlock detected, dumping detailed information.\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2025-11-10T08:52:25.728726+08:00\u0026#34;, \u0026#34;ts\u0026#34;: 1762735945728, \u0026#34;err_symbol\u0026#34;: \u0026#34;ER_IB_MSG_643\u0026#34;, \u0026#34;SQL_state\u0026#34;: \u0026#34;HY000\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;Note\u0026#34; } { \u0026#34;log_type\u0026#34;: 1, \u0026#34;prio\u0026#34;: 3, \u0026#34;err_code\u0026#34;: 12469, \u0026#34;subsystem\u0026#34;: \u0026#34;InnoDB\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;\\n*** (1) TRANSACTION:\\n\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2025-11-10T08:52:25.728850+08:00\u0026#34;, \u0026#34;ts\u0026#34;: 1762735945728, \u0026#34;err_symbol\u0026#34;: \u0026#34;ER_IB_MSG_644\u0026#34;, \u0026#34;SQL_state\u0026#34;: \u0026#34;HY000\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;Note\u0026#34; } { \u0026#34;log_type\u0026#34;: 1, \u0026#34;prio\u0026#34;: 3, \u0026#34;err_code\u0026#34;: 12469, \u0026#34;subsystem\u0026#34;: \u0026#34;InnoDB\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;\\n*** (1) HOLDS THE LOCK(S):\\n\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2025-11-10T08:52:25.728929+08:00\u0026#34;, \u0026#34;ts\u0026#34;: 1762735945728, \u0026#34;err_symbol\u0026#34;: \u0026#34;ER_IB_MSG_644\u0026#34;, \u0026#34;SQL_state\u0026#34;: \u0026#34;HY000\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;Note\u0026#34; } { \u0026#34;log_type\u0026#34;: 1, \u0026#34;prio\u0026#34;: 3, \u0026#34;err_code\u0026#34;: 12469, \u0026#34;subsystem\u0026#34;: \u0026#34;InnoDB\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;\\n*** (1) WAITING FOR THIS LOCK TO BE GRANTED:\\n\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2025-11-10T08:52:25.729280+08:00\u0026#34;, \u0026#34;ts\u0026#34;: 1762735945729, \u0026#34;err_symbol\u0026#34;: \u0026#34;ER_IB_MSG_644\u0026#34;, \u0026#34;SQL_state\u0026#34;: \u0026#34;HY000\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;Note\u0026#34; } { \u0026#34;log_type\u0026#34;: 1, \u0026#34;prio\u0026#34;: 3, \u0026#34;err_code\u0026#34;: 12469, \u0026#34;subsystem\u0026#34;: \u0026#34;InnoDB\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;\\n*** (2) TRANSACTION:\\n\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2025-11-10T08:52:25.729593+08:00\u0026#34;, \u0026#34;ts\u0026#34;: 1762735945729, \u0026#34;err_symbol\u0026#34;: \u0026#34;ER_IB_MSG_644\u0026#34;, \u0026#34;SQL_state\u0026#34;: \u0026#34;HY000\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;Note\u0026#34; } { \u0026#34;log_type\u0026#34;: 1, \u0026#34;prio\u0026#34;: 3, \u0026#34;err_code\u0026#34;: 12469, \u0026#34;subsystem\u0026#34;: \u0026#34;InnoDB\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;\\n*** (2) HOLDS THE LOCK(S):\\n\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2025-11-10T08:52:25.729658+08:00\u0026#34;, \u0026#34;ts\u0026#34;: 1762735945729, \u0026#34;err_symbol\u0026#34;: \u0026#34;ER_IB_MSG_644\u0026#34;, \u0026#34;SQL_state\u0026#34;: \u0026#34;HY000\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;Note\u0026#34; } { \u0026#34;log_type\u0026#34;: 1, \u0026#34;prio\u0026#34;: 3, \u0026#34;err_code\u0026#34;: 12469, \u0026#34;subsystem\u0026#34;: \u0026#34;InnoDB\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;\\n*** (2) WAITING FOR THIS LOCK TO BE GRANTED:\\n\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2025-11-10T08:52:25.729972+08:00\u0026#34;, \u0026#34;ts\u0026#34;: 1762735945729, \u0026#34;err_symbol\u0026#34;: \u0026#34;ER_IB_MSG_644\u0026#34;, \u0026#34;SQL_state\u0026#34;: \u0026#34;HY000\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;Note\u0026#34; } { \u0026#34;log_type\u0026#34;: 1, \u0026#34;prio\u0026#34;: 3, \u0026#34;err_code\u0026#34;: 12469, \u0026#34;subsystem\u0026#34;: \u0026#34;InnoDB\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;*** WE ROLL BACK TRANSACTION (2)\\n\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2025-11-10T08:52:25.730272+08:00\u0026#34;, \u0026#34;ts\u0026#34;: 1762735945730, \u0026#34;err_symbol\u0026#34;: \u0026#34;ER_IB_MSG_644\u0026#34;, \u0026#34;SQL_state\u0026#34;: \u0026#34;HY000\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;Note\u0026#34; } log_sink_internal æ ¼å¼\n2025-11-10T08:52:25.728726+08:00 0 [Note] [MY-012468] [InnoDB] Transactions deadlock detected, dumping detailed information. 2025-11-10T08:52:25.728850+08:00 0 [Note] [MY-012469] [InnoDB] *** (1) TRANSACTION: TRANSACTION 3109, ACTIVE 25 sec starting index read mysql tables in use 1, locked 1 LOCK WAIT 3 lock struct(s), heap size 1128, 2 row lock(s), undo log entries 1 MySQL thread id 2243, OS thread handle 140566786410240, query id 16117 localhost hilife_db updating update t set name = \u0026#39;YangPlus\u0026#39; where id = 1 2025-11-10T08:52:25.728929+08:00 0 [Note] [MY-012469] [InnoDB] *** (1) HOLDS THE LOCK(S): RECORD LOCKS space id 3 page no 4 n bits 72 index PRIMARY of table `Yang`.`t` trx id 3109 lock_mode X locks rec but not gap Record lock, heap no 5 PHYSICAL RECORD: n_fields 4; compact format; info bits 0 0: len 4; hex 00000002; asc ;; 1: len 6; hex 000000000c25; asc %;; 2: len 7; hex 0100000121024c; asc ! L;; 3: len 8; hex 4265636b506c7573; asc BeckPlus;; 2025-11-10T08:52:25.729280+08:00 0 [Note] [MY-012469] [InnoDB] *** (1) WAITING FOR THIS LOCK TO BE GRANTED: RECORD LOCKS space id 3 page no 4 n bits 72 index PRIMARY of table `Yang`.`t` trx id 3109 lock_mode X locks rec but not gap waiting Record lock, heap no 4 PHYSICAL RECORD: n_fields 4; compact format; info bits 0 0: len 4; hex 00000001; asc ;; 1: len 6; hex 000000000c24; asc $;; 2: len 7; hex 02000001230151; asc # Q;; 3: len 8; hex 59616e67506c7573; asc YangPlus;; 2025-11-10T08:52:25.729593+08:00 0 [Note] [MY-012469] [InnoDB] *** (2) TRANSACTION: TRANSACTION 3108, ACTIVE 30 sec starting index read mysql tables in use 1, locked 1 LOCK WAIT 3 lock struct(s), heap size 1128, 2 row lock(s), undo log entries 1 MySQL thread id 2276, OS thread handle 140566770149120, query id 16191 localhost hilife_db updating update t set name = \u0026#39;BeckPlus\u0026#39; where id = 2 2025-11-10T08:52:25.729658+08:00 0 [Note] [MY-012469] [InnoDB] *** (2) HOLDS THE LOCK(S): RECORD LOCKS space id 3 page no 4 n bits 72 index PRIMARY of table `Yang`.`t` trx id 3108 lock_mode X locks rec but not gap Record lock, heap no 4 PHYSICAL RECORD: n_fields 4; compact format; info bits 0 0: len 4; hex 00000001; asc ;; 1: len 6; hex 000000000c24; asc $;; 2: len 7; hex 02000001230151; asc # Q;; 3: len 8; hex 59616e67506c7573; asc YangPlus;; 2025-11-10T08:52:25.729972+08:00 0 [Note] [MY-012469] [InnoDB] *** (2) WAITING FOR THIS LOCK TO BE GRANTED: RECORD LOCKS space id 3 page no 4 n bits 72 index PRIMARY of table `Yang`.`t` trx id 3108 lock_mode X locks rec but not gap waiting Record lock, heap no 5 PHYSICAL RECORD: n_fields 4; compact format; info bits 0 0: len 4; hex 00000002; asc ;; 1: len 6; hex 000000000c25; asc %;; 2: len 7; hex 0100000121024c; asc ! L;; 3: len 8; hex 4265636b506c7573; asc BeckPlus;; 2025-11-10T08:52:25.730272+08:00 0 [Note] [MY-012469] [InnoDB] *** WE ROLL BACK TRANSACTION (2) Dead Lock çš„è©±ï¼Œ\nJSON åè€Œæ²’æœ‰è©³ç´°çš„è³‡è¨Šï¼Œ\nåªèƒ½å–®ç´”åšåˆ°æœ‰ Dead Lock ç™¼ç”Ÿçš„é€šçŸ¥ï¼Œ\nä½† Tableã€Syntax ç­‰ç­‰è³‡è¨Šé‚„æ˜¯éœ€è¦å› Log æŸ¥çœ‹ï¼Œ\nåœ¨é€™é»ä¸Šï¼Œlog_sink_internal å€’æ˜¯æ¯” log_sink_json å¥½å¤šäº†\nERROR Log # Loki expr: count_over_time({type=\u0026ldquo;mysql/errorlog\u0026rdquo;} |= \u0026ldquo;ERROR\u0026rdquo; [1m])\nlog_sink_json æ ¼å¼\n{ \u0026#34;prio\u0026#34;: 1, \u0026#34;err_code\u0026#34;: 10045, \u0026#34;source_line\u0026#34;: 150, \u0026#34;source_file\u0026#34;: \u0026#34;event_scheduler.cc\u0026#34;, \u0026#34;function\u0026#34;: \u0026#34;print_warnings\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;Event Scheduler: [xxxxx@localhost][DB.EVENT] Urgent ERROR\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2025-11-10T15:50:00.903136+08:00\u0026#34;, \u0026#34;ts\u0026#34;: 1762761000903, \u0026#34;thread\u0026#34;: 781, \u0026#34;err_symbol\u0026#34;: \u0026#34;ER_EVENT_MESSAGE_STACK\u0026#34;, \u0026#34;SQL_state\u0026#34;: \u0026#34;HY000\u0026#34;, \u0026#34;subsystem\u0026#34;: \u0026#34;Server\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;Error\u0026#34; } { \u0026#34;prio\u0026#34;: 3, \u0026#34;err_code\u0026#34;: 10046, \u0026#34;source_line\u0026#34;: 429, \u0026#34;source_file\u0026#34;: \u0026#34;event_scheduler.cc\u0026#34;, \u0026#34;function\u0026#34;: \u0026#34;run\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;Event Scheduler: [xxxxx@localhost].[DB.EVENT] event execution failed.\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2025-11-10T15:50:00.903217+08:00\u0026#34;, \u0026#34;ts\u0026#34;: 1762761000903, \u0026#34;thread\u0026#34;: 781, \u0026#34;err_symbol\u0026#34;: \u0026#34;ER_EVENT_EXECUTION_FAILED\u0026#34;, \u0026#34;SQL_state\u0026#34;: \u0026#34;HY000\u0026#34;, \u0026#34;subsystem\u0026#34;: \u0026#34;Server\u0026#34;, \u0026#34;label\u0026#34;: \u0026#34;Note\u0026#34; } log_sink_internal æ ¼å¼\n2025-11-10T15:50:00.903136+08:00 781 [ERROR] [MY-010045] [Server] Event Scheduler: [xxxxx@localhost][DB.EVENT] Urgent ERROR 2025-11-10T15:50:00.903217+08:00 781 [Note] [MY-010046] [Server] Event Scheduler: [xxxxx@localhost].[DB.EVENT] event execution failed. é™¤äº† MySQL Eroor Log çœŸçš„å‡ºç¾çš„éŒ¯èª¤ä»¥å¤–ï¼Œ\né€™é‚„æœ‰ç”¨ä¾†æˆ‘å€‘å…§éƒ¨æ—¥å¸¸ç¶­é‹ä½¿ç”¨ï¼Œ\nç‚ºäº†ç¢ºä¿ç•¶ Event Scheduler å‡ºç¾éŒ¯èª¤æ™‚å¯ä»¥å³æ™‚ç™¼ç¾ï¼Œ\nåœ¨ Event ä¸­æœ‰ä½¿ç”¨\nSIGNAL SQLSTATE \u0026#39;45000\u0026#39; SET MESSAGE_TEXT = \u0026#39;Urgent ERROR\u0026#39;; é€™æ–¹å¼ä¾†å¯«å…¥ Error Logï¼Œ\nå†æ­é… Loki ä¾†é”åˆ°å³æ™‚å‘Šè­¦\nReference # MySQL Documentation : 7.4.2 The Error Log å¾Œä¾† MySQL 8.4 å…§éƒ¨è¨­å®šæª”å…¬ç‰ˆä¿®æ”¹ç‚º log_error_services = \u0026#39;log_sink_internal; log_filter_dragnet; log_sink_json;\u0026#39; dragnet.log_error_filter_rules = \u0026#39;IF err_code == ER_ABORTING_USER_CONNECTION THEN drop.\u0026#39; ER_ABORTING_USER_CONNECTION æ˜¯å› ç‚ºæˆ‘å€‘æ¶æ§‹æ˜¯å»ºç½®åœ¨ GCE ä¸Šï¼Œ\nå‰é¢æœƒæ›ä¸€å±¤ Cloud Load Balancing ä¾†æä¾›æœå‹™ï¼Œ\nè€Œå®ƒçš„ Health checks æœƒé€ æˆ MySQL Error Log çš„å¢é•·ï¼Œ\né¡ä¼¼é€™æ¨£\n2025-11-13T15:37:50.697889+08:00 59287548 [Note] [MY-010914] [Server] Got an error reading communication packets 2025-11-13T15:37:51.492153+08:00 59287550 [Note] [MY-010914] [Server] Got an error reading communication packets é€™æ˜¯å› ç‚º Health checks æ˜¯ä½¿ç”¨ telnet ç­‰çš„æ–¹å¼ä¾†åµæ¸¬ TCP port æ˜¯å¦ aliveï¼Œ\nåœ¨ MySQL æœƒè¢«è¦–ç‚ºé€£ç·šæ²’æœ‰æ­£å¸¸å»ºç«‹ï¼Œå°è‡´ Error Log å‡ºç¾é€™è³‡è¨Šï¼Œ\nåˆå› ç‚ºæˆ‘å€‘å…§éƒ¨è¨­å®šæª”å…¬ç‰ˆæœ‰è¨­å®š log_error_verbosity ç‚º 3ï¼Œ\nå°è‡´æˆ‘å€‘ Error Log æœƒæœ‰å¤§é‡çš„ç„¡æ•ˆè³‡è¨Šç”¢ç”Ÿã€‚\næ‰€ä»¥æˆ‘å€‘åœ¨ filter ä¸­æ–°å¢\n'IF err_code == ER_ABORTING_USER_CONNECTION THEN drop.'\næ—¢å¯ä»¥ä¿ç•™åŸå§‹çš„ Error Log (log_sink_internal)ï¼Œ\nåˆå¯ä»¥æ¸›å°‘é›œè¨Šå¾Œå†å­˜å…¥ JSON Format çš„ Error Log (log_sink_json)\n","date":"13 November 2025","permalink":"https://yangnianli.github.io/blog/error-log-enhanced/","section":"Blog","summary":"","title":"[MySQL 8.4] Error Log Enhanced"},{"content":"","date":null,"permalink":"https://yangnianli.github.io/categories/databases/","section":"Categories","summary":"","title":"Databases"},{"content":"","date":null,"permalink":"https://yangnianli.github.io/tags/mysql/","section":"Tags","summary":"","title":"Mysql"},{"content":"","date":null,"permalink":"https://yangnianli.github.io/tags/mysql8.4/","section":"Tags","summary":"","title":"Mysql8.4"},{"content":" é€™è·Ÿä¹‹å‰æ’°å¯«éçš„é€™ç¯‡é¡ä¼¼\n[AWS] Restoring a backup into an Amazon RDS for MySQL DB instance and Configuring external source replication\nåªæ˜¯ä¸»è§’å¾ RDS for MySQL è®Šæˆäº† Aurora MySQL Introduction #éœ€æ±‚æ˜¯å¸Œæœ› GCP åœ¨ GCE ä¸Šè‡ªå»ºçš„ MySQL è·Ÿ AWS Aurora äº’ç‚ºå‚™æ´ï¼Œ\né”åˆ° DR æ•ˆæœã€‚\nå…·é«”æ¶æ§‹åœ–å¯åƒè€ƒ é©ç”¨å ´æ™¯åœ¨æ–¼ç•¶ DR ç™¼ç”Ÿæ™‚ï¼Œæœƒå°‡ Source å¾ GCP åˆ‡éå» AWS Auroraï¼Œ\nç­‰åˆ° GCP outage è§£æ±ºå¾Œï¼Œæœƒå†å®‰æ’æ™‚é–“æŠŠ Source åˆ‡å›ä¾† GCPã€‚\nç‚ºäº†é”åˆ°é€™éœ€æ±‚ï¼Œ\nåŸä¾†çš„ GCP éœ€è¦æœ‰ä¸€å° ( Standby ) å®šæœŸè·Ÿ AWS Aurora åŒæ­¥è³‡æ–™ - POC2 æ•´æ¢éˆè·¯é è¨ˆåšæ³•\nAWS Aurora DR Step # GCP çš„ MySQL æœå‹™ä½¿ç”¨ Percona XtraBackup ( PXB ) å‚™ä»½ å‚³é€å‚™ä»½æª”è‡³ AWS S3 é‚„åŸè‡³ AWS Aurora å»ºç½® Site-to-Site VPN æ‰“é€š AWS \u0026lt;-\u0026gt; GCP å»ºç½® MySQL Replication ( AWS -\u0026gt; GCP ) - POC1 å»ºç½® Aurora Reader å»ºç½® MySQL -\u0026gt; Aurora Reader ( GCP -\u0026gt; AWS ) - POC2 å»ºç½® AWS RDS DR #POC1 - å»ºç½® MySQL Replication ( AWS -\u0026gt; GCP ) #è«‹åƒç…§ [AWS] Restoring a backup into an Amazon RDS for MySQL DB instance and Configuring external source replication å»ºç½®å³å¯ï¼Œ\néœ€è¦ç‰¹åˆ¥ç•™æ„ä»¥ä¸‹éƒ¨åˆ†\ns3_source_engine : é€™é‚Šè¦è¼¸å…¥ mysql s3_source_engine_version : é€™é‚Šè¦è¼¸å…¥ MySQL çš„ç‰ˆæœ¬ï¼Œä»¥é€™æ¬¡ç‚ºä¾‹ï¼Œè¦è¼¸å…¥ 8.0 Ref : restore-db-cluster-from-s3 - AWS CLI\nè·ŸåŒæ­¥çš„èªæ³•ä½¿ç”¨ rds_set_external_source_with_auto_position\n### é€£åˆ° RDSï¼ŒåŸ·è¡Œä»¥ä¸‹ Stored Procedures CALL mysql.rds_set_external_source_with_auto_position ( host_name , host_port , replication_user_name , replication_user_password , ssl_encryption ); ### æœ¬æ¬¡ç¯„ä¾‹ä½¿ç”¨çš„æŒ‡ä»¤ CALL mysql.rds_set_external_source_with_auto_position ( \u0026#39;10.8.8.8\u0026#39; , 3306 , \u0026#39;aws_rds_rep\u0026#39; , \u0026#39;YangTest@123\u0026#39; , 0 ); ### é–‹å§‹åŒæ­¥ CALL mysql.rds_start_replication() ; ### ç„¶å¾Œå°±æˆåŠŸäº† SHOW REPLICA STATUS \\G Replica_IO_Running: Yes Replica_SQL_Running: Yes å…¶é¤˜ Aurora å°±è·Ÿå»ºç½® RDS æ–¹å¼å¤§åŒå°ç•°\nå…¬å¸å…§éƒ¨ä½¿ç”¨çš„ Terraform Aurora Modules æœ‰æ”¯æ´ Restore From S3 çš„ç›¸é—œé…ç½®ï¼Œ ä½†æ˜¯å…¬å¸å…§éƒ¨ Modulesï¼Œç„¡æ³•åˆ†äº«è«‹è¦‹è«’ï¼Œæœ‰å•é¡Œå¯ä»¥è©¢å•å“¦\nPOC2 - å»ºç½® MySQL -\u0026gt; Aurora Reader ( GCP -\u0026gt; AWS ) #å†å»ºç½®ä¸€å° Aurora Reader # é€™é‚Šä»¥ 02 ç‚ºä¾‹ï¼Œ\nåœ¨ Aurora Cluster ä¸­ï¼Œç¬¬ä¸€å°å»ºç½®çš„ Instance å°±æ˜¯ Writerï¼Œå…¶é¤˜éƒ½æ˜¯ Readerï¼Œ\næ‰€ä»¥ç›®å‰è¦åŠƒä¸Šæœƒå¸Œæœ›ä½¿ç”¨ç„¡æ„ç¾©çš„æµæ°´è™Ÿä¾†ä»£æ›¿æ©Ÿå™¨åç¨±ï¼Œ\nè€Œä¸æ˜¯æœ‰æ„ç¾©çš„ Writer æˆ–è€…æ˜¯ Reader\nè¨­å®š /etc/hosts ( éæ¸¡æœŸä½¿ç”¨ï¼Œå¾ŒçºŒå°å…¥ Internal DNS æ©Ÿåˆ¶å¾Œå¯ä»¥å¿½ç•¥æ­¤æ­¥é©Ÿ ) #å…ˆä½¿ç”¨ AWS bastion è—‰ç”± nslookup å–å¾— Aurora çš„å¯¦éš› IPï¼Œ\nä»¥ä¸‹åœ–ç‚ºä¾‹ï¼ŒIP ç‚º 10.2.1.33\nå°‡ Aurora ç›¸é—œè³‡è¨Šè¨­å®šæ–¼ GCP GCE çš„ /etc/hosts\nAurora é–‹å•Ÿ Binary Logs ä¿ç•™ ( å¾ Writer è¨­å®š ) # Ref : Setting up binary log replication for Aurora MySQL - Amazon Aurora\nå»ºç«‹ GCP -\u0026gt; AWS åŒæ­¥ # ç„¶å¾Œå°±å¤±æ•—å•¦ # MySQL localhost SQL \u0026gt; SHOW REPLICA STATUS \\G *************************** 1. row *************************** Replica_IO_State: Source_Host: xxxxxxx-xxxx-xxx-xxxxx-xxxxxx-xx.xxxxxxxxxxxx.xxxxxxxxx.rds.amazonaws.com Source_User: ******* Source_Port: 3306 Connect_Retry: 60 Source_Log_File: Read_Source_Log_Pos: 4 Relay_Log_File: dba-xxxxx-xxxxxx-xxxxxxx-xxxx-relay-bin.000001 Relay_Log_Pos: 4 Relay_Source_Log_File: Replica_IO_Running: No Replica_SQL_Running: Yes Replicate_Do_DB: Replicate_Ignore_DB: Replicate_Do_Table: Replicate_Ignore_Table: Replicate_Wild_Do_Table: Replicate_Wild_Ignore_Table: Last_Errno: 0 Last_Error: Skip_Counter: 0 Exec_Source_Log_Pos: 0 Relay_Log_Space: 157 Until_Condition: None Until_Log_File: Until_Log_Pos: 0 Source_SSL_Allowed: No Source_SSL_CA_File: Source_SSL_CA_Path: Source_SSL_Cert: Source_SSL_Cipher: Source_SSL_Key: Seconds_Behind_Source: 0 Source_SSL_Verify_Server_Cert: No Last_IO_Errno: 13114 Last_IO_Error: Got fatal error 1236 from source when reading data from binary log: \u0026#39;Binary log is not open\u0026#39; Last_SQL_Errno: 0 Last_SQL_Error: Replicate_Ignore_Server_Ids: Source_Server_Id: 0 Source_UUID: 7868ba12-6342-3cbb-9b8f-ca35a09bf469 Source_Info_File: mysql.slave_master_info SQL_Delay: 0 SQL_Remaining_Delay: NULL Replica_SQL_Running_State: Replica has read all relay log; waiting for more updates Source_Retry_Count: 86400 Source_Bind: Last_IO_Error_Timestamp: 251008 12:41:17 Last_SQL_Error_Timestamp: Source_SSL_Crl: Source_SSL_Crlpath: Retrieved_Gtid_Set: Executed_Gtid_Set: 1b31a695-a3f4-11f0-a8a0-42010a246409:1-45 Auto_Position: 1 Replicate_Rewrite_DB: Channel_Name: Source_TLS_Version: Source_public_key_path: Get_Source_public_key: 0 Network_Namespace: 1 row in set (0.0006 sec) éŒ¯èª¤è¨Šæ¯æ˜¯æ‰¾ä¸åˆ° Binary Logsï¼Œ\nå¾ Reader çš„ SHOW VARIABLES æŸ¥çœ‹ç¢ºå¯¦æ²’æœ‰é–‹å•Ÿï¼Œ\næŸ¥äº†å¹¾ç¯‡æ–‡ç« è·Ÿå®˜æ–¹æ–‡ä»¶ï¼Œç›®å‰æ˜¯æ‡·ç–‘ Replica ä¸æ”¯æ´é–‹å•Ÿ binary logsï¼Œ\nå¾ŒçºŒæœƒå†èˆ‡ AWS TAM ç¢ºèª\nRef :\nNote: Amazon Aurora MySQL does not support BinLog replication on read replicas.\nAmazon Aurora MySQL - Hevo Data You can only pull binary logs from the Writer Instance.\nCan we configure separate binary logging (binlog) on Aurora MySQL\u0026rsquo;s Read REplica instance? POC3 - å»ºç½® MySQL -\u0026gt; Aurora Writer ( GCP -\u0026gt; AWS ) # ä¸Šé¢çš„æ­¥é©Ÿå†ä¾†ä¸€æ¬¡ï¼Œåªæ˜¯é€™æ¬¡æ”¹æˆ Writer\nè¨­å®š /etc/hosts ( éæ¸¡æœŸä½¿ç”¨ï¼Œå¾ŒçºŒå°å…¥ Internal DNS æ©Ÿåˆ¶å¾Œå¯ä»¥å¿½ç•¥æ­¤æ­¥é©Ÿ ) #å…ˆä½¿ç”¨ AWS bastion è—‰ç”± nslookup å–å¾— Aurora çš„å¯¦éš› IPï¼Œ\nä»¥ä¸‹åœ–ç‚ºä¾‹ï¼ŒIP ç‚º 10.2.1.100\nå°‡ Aurora ç›¸é—œè³‡è¨Šè¨­å®šæ–¼ GCP GCE çš„ /etc/hosts\nå»ºç«‹ GCP -\u0026gt; AWS åŒæ­¥ # é€™æ¬¡å°±æˆåŠŸå›‰ #### é–‹å§‹åŒæ­¥ START REPLICA ; ### ç„¶å¾Œå°±æˆåŠŸäº† SHOW REPLICA STATUS \\G Replica_IO_Running: Yes Replica_SQL_Running: Yes Summary #æ²’ä»€éº¼ç‰¹åˆ¥çš„ï¼ŒåŸºæœ¬ä¸Šé€™è·Ÿ Aurora æ²’æœ‰å¤ªå¤šç›¸é—œï¼Œ\né™¤äº† Binary Logs çš„éƒ¨åˆ†æœ‰é»å·®ç•°ä»¥å¤–ï¼Œ\nå…¶é¤˜çš„åªè¦é‹ç”¨ MySQL çš„çŸ¥è­˜ï¼Œä¸æœƒé‡åˆ°ä»€éº¼å¤ªå¤§çš„å•é¡Œ\nAfterword #ERROR: 1267 (HY000): Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_0900_ai_ci,IMPLICIT) for operation \u0026lsquo;regexp_like\u0026rsquo; #ä¸€é–‹å§‹æœ‰é‡åˆ°èªç³»çš„å•é¡Œï¼Œ\nåœ¨ GCP ( Source ) ä½¿ç”¨æˆ‘å€‘ 8.0 å…¬ç‰ˆè¨­å®šæª”ï¼Œ\nç•¶åˆç‚ºäº†å…¼å®¹ 5.7ï¼Œæ‰€ä»¥æœ‰é¡å¤–è¨­å®š\ncollation_server = utf8mb4_general_ci\nå¾ŒçºŒä½¿ç”¨ PXB é‚„åŸè‡³ Aurora å¾Œï¼Œ\nå‡ºç¾ PROCEDURE ( mysql.rds_set_external_source_with_auto_position ) ç„¡æ³•ä½¿ç”¨çš„å•é¡Œ\næŸ¥äº†ä¸€ä¸‹ï¼Œè·Ÿèªç³»æœ‰é—œï¼Œ\nç•¶ Source è¨­å®š collation_server = utf8mb4_general_ciï¼Œ\nç„¶å¾Œä½¿ç”¨ PXB é‚„åŸè‡³ Aurora å¾Œï¼Œ\nAuroa PROCEDURE çš„è¨­å®š\ncollation_connection: utf8mb4_0900_ai_ci Database Collation: utf8mb4_general_ci é è¨­ Aurora æ²’ä¿®æ”¹èªç³»å»ºç«‹å¾Œçš„ PROCEDURE è¨­å®š\ncollation_connection: utf8mb4_0900_ai_ci Database Collation: utf8mb4_0900_ai_ci PROCEDURE ä¸­æœ‰ä¸€æ®µä½¿ç”¨åˆ° REGEXP\nMySQL \u0026gt; SHOW CREATE PROCEDURE mysql.rds_set_external_source_with_auto_position \\G ... SET @regex = \u0026#39;.*\\\u0026#34;[[:space:]]*,[[:space:]]*[a-zA-Z_]+[[:space:]]*=[[:space:]]*\\\u0026#34;.*\u0026#39;; IF host REGEXP @regex OR user REGEXP @regex OR passwd REGEXP @regex THEN SELECT \u0026#34;Invalid arguments\u0026#34; AS Message; ... æ¨æ¸¬èˆ‡é€™æœ‰é—œï¼Œ\nå› èªç³»å·®ç•°ï¼Œé€ æˆä¸Šè¿°éŒ¯èª¤ï¼Œæš«æ™‚æ²’æƒ³åˆ°è§£æ³•ï¼Œ\nå¾ŒçºŒæœƒå†èˆ‡ AWS TAM ç¢ºèª\nç›®å‰ workaround æ˜¯æŠŠ Source çš„ collation_server è¨­å®šç§»é™¤ï¼Œ\nç¶­æŒé è¨­çš„ utf8mb4_0900_ai_ci\nReference # Aurora User Guide ","date":"13 October 2025","permalink":"https://yangnianli.github.io/blog/cross_cloud-mysql-and-aurora-dr-architecture-proof-of-concept/","section":"Blog","summary":"","title":"[AWS] Cross-Cloud MySQL and Aurora DR Architecture - Proof of Concept"},{"content":"","date":null,"permalink":"https://yangnianli.github.io/tags/aurora/","section":"Tags","summary":"","title":"Aurora"},{"content":"","date":null,"permalink":"https://yangnianli.github.io/categories/aws/","section":"Categories","summary":"","title":"Aws"},{"content":" é€™æ˜¯ What Is New in MySQL 8.4 since MySQL 8.0 çš„ç³»åˆ—æ–‡ï¼Œ\næœƒé‡å°éƒ¨åˆ†æˆ‘è¦ºå¾—è·Ÿæ—¥å¸¸ç¶­é‹æœ‰é—œçš„æ›´å‹•ç‰¹åˆ¥ç ”ç©¶ï¼Œ\nå…¶é¤˜çš„å°±ç•¶æ•…äº‹æ›¸ï¼Œçœ‹éçŸ¥é“å³å¯ Introduction #Scalar correlated subqueries to derived tables.\nMySQL 8.4.0 lifts a previous restriction on transforming a correlated scalar subquery to a derived table such that an operand of the equality expression which did not contain an outer reference could be a simple column reference only.\nThis means that inner columns can be contained in deterministic expressions, as shown here:\nfunc1(.., funcN(.., inner-column-a, ..), inner-column-b) = outside-expression inner-column-a + inner-column-b = outside-expression For example, the following query is now supported for optimization:\nSELECT * FROM t1 WHERE ( SELECT func(t2.a) FROM t2 WHERE func(t2.a) = t1.a ) \u0026gt; 0; The inner operand cannot contain outer column references; likewise, the outer operand cannot contain inner column references. In addition, the inner operand cannot contain a subquery.\nIf the transformed subquery has explicit grouping, functional dependency analysis may be excessively pessimistic, resulting in an error such as ERROR 1055 (42000): Expression #2 of SELECT list is not in GROUP BY clause and contains nonaggregated column ....\nFor the InnoDB storage engine, the transform is disabled by default (that is, the subquery_to_derived flag of the optimizer_switch variable is not enabled); in this case, such queries pass without raising any errors, but are also not transformed.\nSee Section 15.2.15.7, â€œCorrelated Subqueriesâ€, for more information.\nä»¥ä¸Šå¼•ç”¨è‡³å®˜æ–¹åŸæ–‡\nSummary #å…ˆè¬›çµè«–ï¼Œé è¨­ subquery_to_derived é€™ optimizer_switch æ˜¯ é—œé–‰ çš„ï¼Œ\næˆ‘å€‘ä¹Ÿæ²’æœ‰ç‰¹åˆ¥èª¿æ•´éè¨­å®šæª”å…¬ç‰ˆï¼Œæ‰€ä»¥å½±éŸ¿æ²’æœ‰å¾ˆå¤§ï¼Œ\nçŸ¥é“æœ‰é€™åŠŸèƒ½ï¼Œæ—¥å¾Œæœ‰éœ€è¦æ™‚ï¼Œå†çœ‹çœ‹æœ‰æ²’æœ‰åˆé©å³å¯ã€‚\né è¨­æ˜¯é—œé–‰çš„åŸå› æ˜¯ï¼Œ\nåœ¨å¤§å¤šæƒ…æ³ä¸‹ï¼Œé–‹å•Ÿè©²åƒæ•¸ä¸¦æ²’æœ‰é¡¯è‘—çš„æ•ˆèƒ½æ”¹å–„ ( ç”šè‡³æœƒæœ‰æ›´æ…¢çš„ç¾è±¡ )\né€™å¥è©±æ˜¯å®˜æ–¹æ–‡æª”å¯«çš„ï¼Œä¸æ˜¯é€ è¬  ğŸ¤—\nåŸæ–‡ : The default value for this flag is off, since, in most cases, enabling this optimization does not produce any noticeable improvement in performance (and in many cases can even make queries run more slowly)\né€™åŠŸèƒ½æœ€æ—©æ˜¯åœ¨ 8.0.21 æ–°å¢çš„ï¼Œ8.4 åªæ˜¯å°è©²åŠŸèƒ½å¢åŠ æ›´å¤šæ”¯æ´ï¼Œ\nç•¶ correlated subqueries æ˜¯ deterministic funtions æ™‚ï¼Œ\nå°±å¯ä»¥è¢« subquery_to_derived é€²è¡Œæ”¹å¯«å„ªåŒ–\nè«‹åƒè€ƒä»¥ä¸‹å·®ç•°\nMySQL 8.4 #SHOW CREATE TABLE t1 \\G *************************** 1. row *************************** Table: t1 Create Table: CREATE TABLE `t1` ( `a` int NOT NULL, PRIMARY KEY (`a`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utfTE TABLE t2 \\G *************************** 1. row *************************** Table: t2 Create Table: CREATE TABLE `t2` ( `a` int NOT NULL, PRIMARY KEY (`a`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci /* subquery_to_derived é è¨­ç‚º OFF */ SELECT @@optimizer_switch like \u0026#39;%subquery_to_derived=OFF%\u0026#39; AS \u0026#39;subquery_to_derived=OFF\u0026#39; ; +-------------------------+ | subquery_to_derived=OFF | +-------------------------+ | 1 | +-------------------------+ 1 row in set (0.0008 sec) EXPLAIN SELECT * FROM t1 WHERE ( SELECT COUNT(t2.a) FROM t2 WHERE CAST(t2.a AS BINARY) = t1.a ) \u0026gt; 0 ; +----+--------------------+-------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+--------------------+-------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+ | 1 | PRIMARY | t1 | NULL | index | NULL | PRIMARY | 4 | NULL | 1 | 100 | Using where; Using index | | 2 | DEPENDENT SUBQUERY | t2 | NULL | index | NULL | PRIMARY | 4 | NULL | 1 | 100 | Using where; Using index | +----+--------------------+-------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+ 2 rows in set, 2 warnings (0.0008 sec) SET SESSION optimizer_switch = \u0026#39;subquery_to_derived=on\u0026#39; ; /* subquery_to_derived æ”¹æˆ ON */ SELECT @@optimizer_switch like \u0026#39;%subquery_to_derived=ON%\u0026#39; AS \u0026#39;subquery_to_derived=ON\u0026#39; ; +------------------------+ | subquery_to_derived=ON | +------------------------+ | 1 | +------------------------+ 1 row in set (0.0003 sec) EXPLAIN SELECT * FROM t1 WHERE ( SELECT COUNT(t2.a) FROM t2 WHERE CAST(t2.a AS BINARY) = t1.a ) \u0026gt; 0 ; +----+-------------+------------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------------------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+-------------+------------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------------------------+ | 1 | PRIMARY | t1 | NULL | index | NULL | PRIMARY | 4 | NULL | 1 | 100 | Using index | | 1 | PRIMARY | \u0026lt;derived2\u0026gt; | NULL | ALL | NULL | NULL | NULL | NULL | 2 | 100 | Using where; Using join buffer (hash join) | | 2 | DERIVED | t2 | NULL | index | PRIMARY | PRIMARY | 4 | NULL | 1 | 100 | Using index; Using temporary | +----+-------------+------------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------------------------+ 3 rows in set, 2 warnings (0.0014 sec) MySQL 8.0 #SHOW CREATE TABLE t1 \\G *************************** 1. row *************************** Table: t1 Create Table: CREATE TABLE `t1` ( `a` int NOT NULL, PRIMARY KEY (`a`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utfTE TABLE t2 \\G *************************** 1. row *************************** Table: t2 Create Table: CREATE TABLE `t2` ( `a` int NOT NULL, PRIMARY KEY (`a`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci /* subquery_to_derived é è¨­ç‚º OFF */ SELECT @@optimizer_switch like \u0026#39;%subquery_to_derived=OFF%\u0026#39; AS \u0026#39;subquery_to_derived=OFF\u0026#39; ; +-------------------------+ | subquery_to_derived=OFF | +-------------------------+ | 1 | +-------------------------+ 1 row in set (0.0007 sec) EXPLAIN SELECT * FROM t1 WHERE ( SELECT COUNT(t2.a) FROM t2 WHERE CAST(t2.a AS BINARY) = t1.a ) \u0026gt; 0 ; +----+--------------------+-------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+--------------------+-------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+ | 1 | PRIMARY | t1 | NULL | index | NULL | PRIMARY | 4 | NULL | 1 | 100 | Using where; Using index | | 2 | DEPENDENT SUBQUERY | t2 | NULL | index | NULL | PRIMARY | 4 | NULL | 1 | 100 | Using where; Using index | +----+--------------------+-------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+ 2 rows in set, 2 warnings (0.0016 sec) SET SESSION optimizer_switch = \u0026#39;subquery_to_derived=on\u0026#39; ; /* subquery_to_derived æ”¹æˆ ON */ SELECT @@optimizer_switch like \u0026#39;%subquery_to_derived=ON%\u0026#39; AS \u0026#39;subquery_to_derived=ON\u0026#39; ; +------------------------+ | subquery_to_derived=ON | +------------------------+ | 1 | +------------------------+ 1 row in set (0.0008 sec) EXPLAIN SELECT * FROM t1 WHERE ( SELECT COUNT(t2.a) FROM t2 WHERE CAST(t2.a AS BINARY) = t1.a ) \u0026gt; 0 ; +----+--------------------+-------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+ | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | filtered | Extra | +----+--------------------+-------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+ | 1 | PRIMARY | t1 | NULL | index | NULL | PRIMARY | 4 | NULL | 1 | 100 | Using where; Using index | | 2 | DEPENDENT SUBQUERY | t2 | NULL | index | NULL | PRIMARY | 4 | NULL | 1 | 100 | Using where; Using index | +----+--------------------+-------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+ 2 rows in set, 2 warnings (0.0010 sec) ä¸»è¦é—œæ³¨æ–¼æœ€å¾Œ EXPLAIN çš„çµæœ\nåœ¨ MySQL 8.4ï¼Œé–‹å•Ÿ subquery_to_derived=ON æ™‚ï¼Œ\nåªè¦ correlated subqueries çš„ functions æ˜¯ deterministicï¼Œ\nå°±å¯ä»¥è¢«æ”¹å¯«æˆ derived table çš„èªæ³•é€²è¡ŒæŸ¥è©¢ã€‚\nåœ¨ MySQL 8.0 æ™‚ï¼Œåªæœ‰æ”¯æ´ simple column references\nType Example Deterministic Functions SUBSTR(),CONCAT(),CAST()... Nondeterministic Functions RAND(),NOW(),UUID()... Afterword #é€™ç¯‡å†ç ”ç©¶å¾Œå°±é»˜é»˜åœ°æŠŠå®ƒç§»é™¤ â­ çš„æ¨™è¨˜äº† ğŸ˜‚\nä¸€é–‹å§‹æ˜¯å› ç‚ºçœ‹åˆ°é€™è·Ÿ optimizer_switch æœ‰é—œï¼Œ\næ‰€ä»¥æ‰å°‡å…¶æ¨™è¨˜ç‚º â­ï¼Œ\næ·±å…¥ç ”ç©¶å¾Œç™¼ç¾é€™ç•°å‹•ä¼¼ä¹æ²’ä»€éº¼å¤ªå¤§çš„å½±éŸ¿ï¼Œ\nç•¢ç«Ÿå®˜æ–¹æ–‡æª”éƒ½èªªäº†ï¼Œé è¨­ç‚º é—œé–‰ çš„åŸå› æ˜¯å› ç‚ºå°æ–¼å¤§å¤šæ•¸æ‡‰ç”¨ä¾†èªªï¼Œ\né€™æ”¹è®Šä¸¦æ²’æœ‰å¸¶ä¾†é¡¯è‘—çš„æ”¹å–„ã€‚\né€™æ™‚åè€Œè®“æˆ‘å¥½å¥‡ç‚ºä»€éº¼æœ‰é€™æ”¹å‹•ï¼Œäº‹æƒ…çš„æºé ­æ˜¯ä»€éº¼ ? æ¥è‘—å°±å»ç¿»äº† WorkLogï¼Œ\nOpen Source çš„å¥½è™•å°±æ˜¯å…¨éƒ¨çš„ç•°å‹•ç´€éŒ„éƒ½å¯ä»¥åœ¨ Git ä¸Šæ‰¾åˆ°ï¼Œ\nè€Œä¸”é€™ç¨®æœ‰è¦æ¨¡çš„ Open Source Project éƒ½æœƒæœ‰è©³ç´°çš„èªªæ˜ä»¥åŠç´€éŒ„ã€‚\nMySQL 8.0 ä¸€é–‹å§‹æ–°å¢çš„ commit åœ¨ WL#13520ï¼Œ\né‡é»åœ¨æ–¼å…¶ä¸­å¯«åˆ°çš„é€™å¥ : It is on by default for secondary engines like RAPID.\nåˆå¸¶ä¾†äº†å¦å¤–çš„å¥½å¥‡ï¼Œ\nä»€éº¼æ˜¯ Secondary Engines ?\nMySQL ä¸æ˜¯å°±åªå‰©ä¸‹ InnoDB Engines è€Œå·²å— ? ( NDB é™¤å¤– )\næŸ¥äº†ä¸€ä¸‹ç™¼ç¾ï¼Œ\nåŸä¾†é€™å…¨æ˜¯ç‚ºäº† Oracle MySQL Enterprise åœ¨é‹ªè·¯å‘€ ğŸ˜ˆ\nä¸ç®¡æ˜¯ Secondary Engines é‚„æ˜¯ RAPIDï¼Œ\né€™éƒ½è·Ÿ MySQL HeatWave æœ‰é—œï¼Œ\nMySQL 8.4 é€™æ¬¡çš„ç•°å‹• commit åœ¨ WL#15540ï¼Œ\nå…¶ä¸­çš„é€™å¥ : This transformation is needed by Heatwave/RAPID, which doesn't support subqueries in the WHERE clause. ä¹Ÿå¯ä»¥ç™¼ç¾ï¼Œ\né€™ç•°å‹•éƒ½æ˜¯ç‚ºäº† MySQL HeatWave åšçš„æ”¹å–„ï¼Œ\né€™ä¸‹ç–‘æƒ‘éƒ½è§£é–‹äº†ï¼Œ\nç›®å‰å…¬å¸ä¸»è¦æ˜¯ä½¿ç”¨ Percona MySQLï¼Œ\nçŸ­æ™‚é–“å…§æ‡‰è©²æ˜¯æ²’è¾¦æ³•æ‘¸åˆ° MySQL HeatWave ä¾†ç©ç©äº†ï¼Œ\nåªèƒ½ç­‰åˆ°æ—¥å¾Œæœ‰æœä¸€æ—¥ï¼Œå†ä¾†çœ‹çœ‹é€™æ”¹å‹•å°æ–¼ MySQL HeatWave æœ‰ä»€éº¼æ”¹å–„å§\nReference # GitHub : mysql-server Commit 8fda114 GitHub : mysql-server Commit 0354e46 MySQL Documentation : 15.2.15.7 Corrlated Subqueries MySQL HeatWave Documentation : 4.2.6.2 Define the Secondary Engine ","date":"1 October 2025","permalink":"https://yangnianli.github.io/blog/scalar-correlated-subqueries-to-derived-tables/","section":"Blog","summary":"","title":"[MySQL 8.4] Scalar Correlated Subqueries to Derived Tables"},{"content":"Introduction #éœ€æ±‚æ˜¯å¸Œæœ› GCP ä¸Šä½¿ç”¨ GCE è‡ªæ¶çš„ MySQL æœå‹™å¯ä»¥åŒæ­¥è³‡æ–™è‡³ AWS RDSï¼Œ\næä¾›çµ¦éƒ¨ç½²æ–¼ AWS çš„æœå‹™å­˜å–ä½¿ç”¨ï¼Œåƒ…éœ€è¦ ReadOnlyï¼Œä¸éœ€è¦ Writeï¼Œ\né™¤äº†å¯ä»¥é™ä½ AWS çš„ç¨‹å¼ â†’ GCP çš„ç¶²è·¯å‚³è¼¸è²»ç”¨ä»¥åŠå»¶é²ï¼Œ\nä¹Ÿå¯ä»¥é”åˆ° DR çš„ä½œç”¨\né è¨ˆåšæ³•\nGCP çš„ MySQL æœå‹™ä½¿ç”¨ Percona XtraBackup ( PXB ) å‚™ä»½\nå‚³é€å‚™ä»½æª”è‡³ AWS S3\né‚„åŸè‡³ AWS RDS\nå»ºç½®å¤–ç¶² ( or Site-to-Site VPN ) åŒæ­¥ ( AWS â†’ GCP )\nåŸºæœ¬ä¸Šï¼Œé€™äº›åŠŸèƒ½ RDS éƒ½æœ‰æä¾›ï¼Œä¹Ÿæœ‰ç›¸å°æ‡‰çš„å®˜æ–¹æ–‡ä»¶ï¼Œ\næƒ³äº†ä¸€ä¸‹ï¼Œé›£åº¦ä¸å¤§ï¼Œå°±ç›´æ¥å‹•å·¥å§\np.s. é™¤äº†ä½¿ç”¨ MySQL Native Replication ä»¥å¤–ï¼Œ\né‚„æœ‰å¦å¤–ä¸€å€‹å‚™æ¡ˆ - AWS DMS\nä¹Ÿå¯ä»¥é”åˆ°ç›¸åŒçš„çµæœï¼Œåªæ˜¯åŒæ­¥è³‡æ–™çš„æ–¹å¼æ”¹æˆä½¿ç”¨ DMS å¯¦ç¾\nRestoring a backup into an Amazon RDS for MySQL DB instance # å»ºç½® GCP æ¸¬è©¦æ©Ÿ # å› ç‚ºæ¸¬è©¦éç¨‹æœƒéœ€è¦æ–°å¢ fw ç›¸é—œè¨­å®šï¼Œæ•…æ­¤æ¬¡æ¸¬è©¦æ˜¯ä½¿ç”¨æ¸¬è©¦å°ˆæ¡ˆè‡ªå»º VPCï¼Œ\næ­£å¼å•Ÿç”¨æ™‚æ˜¯ä½¿ç”¨ XPN æ¶æ§‹ï¼Œä½†åŸç†è·Ÿæ­¥é©Ÿæ˜¯ç›¸åŒçš„\nå»ºç½® VPC / Subnets #### VPC gcloud compute networks create ${VPC_NAME} \\ --project=${PROJECT_ID} \\ --subnet-mode=custom \\ --mtu=1460 \\ --bgp-routing-mode=regional \\ --bgp-best-path-selection-mode=legacy ### Subnets ( CIDR è‡ªå®šå³å¯ ) gcloud compute networks subnets create ${SUBNETS_NAME} \\ --project=${PROJECT_ID} \\ --range=${CIDR} \\ --stack-type=IPV4_ONLY \\ --network=${VPC_NAME} \\ --region=asia-east1 å»ºç½® FW #### Allow AWS RDS ( source-ranges å¾ AWS VPC -\u0026gt; NAT gateways æŸ¥çœ‹ ) gcloud compute firewall-rules create ${FW_NAME} \\ --project=${PROJECT_ID} \\ --direction=INGRESS \\ --priority=1000 \\ --network=${VPC_NAME} \\ --action=ALLOW \\ --rules=tcp:3306 \\ --source-ranges=18.138.94.177/32,52.77.51.245/32,18.138.128.251/32 å»ºç½® MySQL #é€™é‚Šæ˜¯ä½¿ç”¨å…§éƒ¨è‡ªç ”çš„å¹³å°å»ºç½®ï¼Œå°±ä¸å±•é–‹èªªæ˜äº†\nå»ºç½® External Load Balancer #æ–°å¢ External Load Balancer è·Ÿ Instance Groupsï¼Œæ²’æœ‰ä»€éº¼éœ€è¦ç‰¹åˆ¥ç•™æ„çš„\nä½¿ç”¨ PXB å‚™ä»½è‡³ AWS S3 #Install AWS CLI #curl \u0026#34;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\u0026#34; -o \u0026#34;awscliv2.zip\u0026#34; unzip awscliv2.zip sudo ./aws/install Configuration AWS CLI # å› ç‚º AWS æ¸¬è©¦ç’°å¢ƒçš„ Account æ˜¯æ¡ç”¨ SSO ç™»å…¥ï¼Œ\nä¹‹å‰ä½¿ç”¨éçš„ Access Key æ–¹æ¡ˆå·²ç¶“ç„¡æ³•ä½¿ç”¨å›‰\naws configure sso --use-device-code PXB å‚™ä»½è‡³ AWS S3 #### å°±å–®ç´”å‚™ä»½ï¼Œæ²’ç‰¹åˆ¥è¦èªªæ˜çš„ï¼Œè¨˜å¾—ä½¿ç”¨ xbstream xtrabackup --backup --user=${USERNAME} \\ --password \\ --stream=xbstream \u0026gt; yangtest.xbstream ### å‚³åˆ° s3 aws s3 cp yangtest.xbstream s3://aws_s3_bucket_name é‚„åŸè‡³ AWS RDS # å…¬å¸å…§éƒ¨ä½¿ç”¨çš„ Terraform RDS Modules æœ‰æ”¯æ´ Restore From S3 çš„ç›¸é—œé…ç½®ï¼Œ\nä½†æ˜¯å…¬å¸å…§éƒ¨ Modulesï¼Œç„¡æ³•åˆ†äº«è«‹è¦‹è«’ï¼Œæœ‰å•é¡Œå¯ä»¥è©¢å•å“¦\nä¸»è¦æ–°å¢\ns3_import_bucket_name = \u0026#34;aws_s3_bucket_name\u0026#34; s3_import_ingestion_role = \u0026#34;arn:aws:iam::xxxxxxxxxxxx:role/rds-restore-from-s3-role\u0026#34; å…¶é¤˜å°±è·Ÿä¸€èˆ¬ä½¿ç”¨ Terraform ä¾†éƒ¨ç½² RDS ä¸€æ¨£\ns3_import_bucket_name : è¦é‚„åŸçš„ s3 bucket åç¨± s3_import_ingestion_role : ä½¿ç”¨å“ªå€‹ Role ä¾†åŸ·è¡Œ Configuring external source replication # AWS RDS Documentation : Configuring, starting, and stopping binary log ( binlog ) replication\n### é€£åˆ° RDSï¼ŒåŸ·è¡Œä»¥ä¸‹ Stored Procedures CALL mysql.rds_set_external_master_with_auto_position ( host_name , host_port , replication_user_name , replication_user_password , ssl_encryption , delay ); ### æœ¬æ¬¡ç¯„ä¾‹ä½¿ç”¨çš„æŒ‡ä»¤ CALL mysql.rds_set_external_master_with_auto_position ( \u0026#39;35.221.236.11\u0026#39; , 3306 , \u0026#39;aws_rds_rep\u0026#39; , \u0026#39;YangTest@123\u0026#39; , 1 , 0 ); ### é–‹å§‹åŒæ­¥ CALL mysql.rds_start_replication; ### ç„¶å¾Œå°±æˆåŠŸäº† SHOW SLAVE STATUS \\G Slave_IO_Running: Yes Slave_SQL_Running: Yes p.s. å¦‚æœ PXB çš„ä¾†æºæ˜¯ Replica çš„è©±ï¼Œ\nå¯ä»¥ä¸ç”¨é‡æ–°è¨­å®š rds_set_external_master_with_auto_positionï¼Œ\nå› ç‚ºç›¸é—œè³‡æ–™å·²ç¶“å­˜æ”¾æ–¼ mysql.slave_master_info ä¸­ï¼Œ\nåªéœ€è¦åŸ·è¡Œ mysql.rds_start_replication å³å¯\nTroubleshooting #Q : [å…§éƒ¨è‡ªç ”å¹³å°] é¸ä¸åˆ°è‡ªå»ºçš„ Subnets #A : å› ç‚ºè¨­å®šæª”ä¸­æœ‰åƒæ•¸ä¾†æ±ºå®šå¹³å°å»ºç½®æ©Ÿå™¨æ‰€éœ€è¦ä½¿ç”¨åˆ°çš„ ç¶²è·¯å°ˆæ¡ˆï¼Œ\næœƒé€™æ¨£è¨­è¨ˆçš„åŸå› æ˜¯å› ç‚ºæˆ‘å€‘ç¶²è·¯ç’°å¢ƒå¤§å¤šæ˜¯ä½¿ç”¨ XPN æ¶æ§‹ï¼Œ\næ‰€ä»¥éœ€è¦å°‡ ç¶²è·¯å°ˆæ¡ˆ è¨­å®šç‚ºä¸åŒçš„ Project\nQ : [å…§éƒ¨è‡ªç ”å¹³å°] é‚„æ˜¯é¸ä¸åˆ°å‘€ #A : é¡ä¼¼å•é¡Œï¼Œå› ç‚ºè¨­å®šæª”ä¸­æœ‰è¨­å®š filter ä¾†éæ¿¾ Subnetsï¼Œ\nåŸå› æ˜¯å› ç‚ºæ—©æœŸ GCP å°ˆæ¡ˆä½¿ç”¨çš„ç¶²è·¯æ¶æ§‹æ˜¯ VPC ä¸åˆ†ç’°å¢ƒï¼Œ\nä¹Ÿå°±æ˜¯ prodã€staging ä»¥åŠ test ç­‰ç­‰éƒ½åœ¨åŒä¸€å€‹ VPC åº•ä¸‹ï¼Œ\nä½†åœ¨è‡ªç ”å¹³å°ä¸­éœ€è¦å€åˆ†ç’°å¢ƒï¼Œ\næ‰€ä»¥æ‰è—‰ç”± filter ä¾†éæ¿¾éœ€è¦çš„ Subnets\nQ : [IAP] failed to connect to backend #A : æˆ‘å€‘ç›®å‰é€£ç·šåˆ° GCE éƒ½æ˜¯è—‰ç”± IAP ä¾†å¯¦ç¾ï¼Œ\nå¯åƒè€ƒ GCP IAP Doc å»ºç½® FW å¾Œå°±å¯ä»¥é€£ç·šå›‰!\n### Allow IAP Access ( CIDR æ˜¯å›ºå®šçš„ ) gcloud compute firewall-rules create allow-iap-access \\ --project=${PROJECT_ID} \\ --direction=INGRESS \\ --priority=1000 \\ --network=${VPC_NAME} \\ --action=ALLOW \\ --rules=tcp:22 \\ --source-ranges=35.235.240.0/20 Q : [startup-script] æ²’æœ‰åŸ·è¡Œ #A : å› ç‚ºæ©Ÿå™¨ç„¡æ³•å°å¤–ï¼Œéœ€è¦è¨­å®š Cloud NAT\n### Create Cloud Router ( aws-test-router ) gcloud compute routers create aws-test-router \\ --project=${PROJECT_ID} \\ --region=asia-east1 \\ --network=${VPC_NAME} ### Create Cloud NAT gateway ( aws-test-nat ) gcloud compute routers nats create aws-test-nat \\ --project=${PROJECT_ID} \\ --router=aws-test-router \\ --region=asia-east1 \\ --nat-all-subnet-ip-ranges \\ --auto-allocate-nat-external-ips Q : [startup-script] ç›£æ§å®‰è£å¤±æ•— #A : é€™æ˜¯ä¸€é€£ä¸²çš„éŒ¯èª¤é€ æˆçš„çµæœï¼Œ\nRoot Cause æ˜¯å› ç‚ºå‘¼å«ä¸åˆ°å…§éƒ¨çš„ APIï¼Œ\næ‰€ä»¥æ²’è¾¦æ³•å–å¾— my.cnf çš„è¨­å®šï¼Œ\né€ æˆ my.cnf ä½¿ç”¨ MySQL é è¨­çš„è¨­å®šï¼Œ\nå°è‡´ startup-script åŸ·è¡Œä¿®æ”¹å¸³å¯†æ™‚æ²’è¾¦æ³•å–å¾—å¯†ç¢¼è€Œä¿®æ”¹å¤±æ•—ï¼Œ\næœ€çµ‚é€ æˆçš„çµæœå°±æ˜¯ç›£æ§æ²’è¾¦æ³•ç™»å…¥ï¼Œå‡ºç¾å®‰è£å¤±æ•—\nè§£æ±ºè¾¦æ³•ï¼Œæš«æ™‚å°‡ ä¸Šè¿° Cloud NAT ç”¢ç”Ÿçš„ IP æ–°å¢è‡³ API çš„ allow_list\næˆåŠŸå¾Œè¨˜å¾—åˆªé™¤ allow_list Q : [SSO] oauth callback error 127.0.0.1 # A : ä½¿ç”¨ aws configure sso æ™‚æœƒè·³ OAuth callback å¤±æ•—ï¼Œ\nè«‹åƒè€ƒ New SSO Implementation Broken When Used Across Multiple Machines Â· Issue #9228 Â· aws/aws-cliï¼Œ\nåŠ ä¸Š --use-device-code å³å¯\nQ : [AWS IAM] å„ç¨®æ¬Šé™éŒ¯èª¤ #A : æºè‡ªæ–¼å° AWS IAM ä¸ç†Ÿæ‚‰å°è‡´ï¼Œ\nåŸºæœ¬ä¸Šé€™åœ¨ AWS Doc ä¸­éƒ½æœ‰æåˆ° Creating an IAM role manually\nTrust Policy # å¯èƒ½æˆ‘æ²’æ…§æ ¹ï¼Œå®˜æ–¹æä¾›çš„ç¯„ä¾‹çœŸçš„å¾ˆç¯„ä¾‹ï¼Œ\né€™é‚Šçš„ Service è¦å¡«å…¥ rds.amazonaws.com\n{\u0026quot;Service\u0026quot;: \u0026quot;rds.amazonaws.com\u0026quot;}\nä»£è¡¨é€™å€‹ Role å¯ä»¥è®“ RDS Assume\nRole Permissions # å› ç‚ºé€™é‚Šæˆ‘æ²’æœ‰ Create inline policy çš„æ¬Šé™ï¼Œ\næ‰€ä»¥æˆ‘åªèƒ½å…ˆçµ¦ AWS managed çš„ Policyï¼Œ\nç‚ºäº†ç¬¦åˆéœ€æ±‚ï¼Œæˆ‘é€™é‚Šæ˜¯è³¦äºˆäº† AmazonS3ReadOnlyAccess æ¬Šé™\nä»£è¡¨é€™å€‹ Role æ“æœ‰ S3 ReadOnly çš„æ¬Šé™\niam:PassRole # åˆæ˜¯ä¸€å€‹æˆ‘æ²’æ…§æ ¹çš„ç¯„ä¾‹ï¼Œ\né€™æ˜¯è¦åŠ åœ¨ ä½¿ç”¨è€… çš„æ¬Šé™ï¼Œ\nä»¥æˆ‘å€‘ç›®å‰ AWS Account çš„è¦åŠƒä¾†èªªï¼Œ\nå­˜åœ¨ä¸€å€‹ Rolesï¼Œåç¨±ç‚º AWSReservedSSO_DatabaseAdministrator_xxxxxxï¼Œ\nè¦å°‡æ¬Šé™åŠ åˆ°è©² Roles ä¸Šï¼Œ\nä»£è¡¨ æ“æœ‰ PassRole S3Access é€™å€‹ Role çµ¦ Service çš„æ¬Šé™\né¡å¤–èªªæ˜ä¸€ä¸‹ç‚ºä»€éº¼ AWS æœƒè¨­è¨ˆ iam:PassRole çš„åŸå› ï¼Œ\nä¸»è¦æ˜¯å®‰å…¨ä¸Šçš„è€ƒé‡\nä»Šå¤©æœ‰ä¸€ä½ User å»ºäº†ä¸€å° EC2ï¼Œä¸¦è³¦äºˆ EC2 Instance Role çš„æ¬Šé™ï¼Œ\nä¸€åˆ‡éƒ½å¾ˆæ­£å¸¸ã€å¾ˆç¾å¥½ ğŸ¤—ğŸ¤—ğŸ¤—\næœ‰å€‹ Bad User å‡ºç¾äº†ï¼Œ\nä»–æ˜æ˜åªæœ‰ LimitedAccessPolicy çš„æ¬Šé™ï¼Œç†è«–ä¸Šæ¬Šé™è¼ƒä½ï¼Œ\nä½†å› ç‚ºå»ºäº†ä¸€å° EC2ï¼Œä¸¦è³¦äºˆ EC2 æœ‰è¼ƒé«˜æ¬Šé™çš„ AdministratorAccess Roleï¼Œ\né€™æ™‚ Bad User å°±å¯ä»¥è—‰ç”± SSH åˆ°è©²å° EC2 Instanceï¼Œ\nä½¿ç”¨è¼ƒé«˜æ¬Šé™çš„ Role å»å‘¼å« AWS çš„ APIsï¼Œ\næ¬Šé™å°±è¢«ç¹éå»äº†\nè§£æ±ºæ–¹æ¡ˆ iam:PassRole å‡ºç¾äº†!\nä¸»è¦æ˜¯ç”¨ä¾† é™åˆ¶ User å¯ä»¥æŠŠå“ªäº› Role è³¦äºˆ Service ä½¿ç”¨çš„æ¬Šé™\nä»¥ä¸Šä¾‹å­ä¾†èªªï¼Œæˆ‘å€‘å¯ä»¥æ–°å¢ Allow iam:PassRole LimitedAccess\n{ \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: \u0026#34;iam:PassRole\u0026#34;, \u0026#34;Resource\u0026#34;: \u0026#34;arn:aws:::123456789012:role/LimitedAccess\u0026#34; } Bad User ä¾¿ä¸èƒ½è³¦äºˆ AdministratorAccess Role çš„æ¬Šé™çµ¦ EC2 Serviceï¼Œ\nåªèƒ½è³¦äºˆ LimitedAccess Roleï¼Œä¸€å¤©åˆå¹³å®‰çš„éå»äº†ï¼Œå¯å–œå¯è³€ ğŸ¤—ğŸ¤—ğŸ¤—\nSummary #åŸºæœ¬ä¸Šé€™å€‹ä»»å‹™æƒ³åƒèµ·ä¾†æ²’æœ‰ä»€éº¼å¤ªå¤§çš„å›°é›£ï¼Œ\nå¯¦éš›æŒ‰ç…§å®˜æ–¹ Documentation æ“ä½œä¹Ÿåªæœ‰å°‘å°‘çš„ 1-2 é ï¼Œ\nä½†å°±å¦‚åŒæœ¬ç¯‡æ–‡ç« çš„ç¾å¯¦è¡æ“Šï¼Œ\nTroubleshooting çš„ç¯‡å¹…å¤§æ¦‚æ¯”å¯¦éš›æ“ä½œå¤šäº†ä¸€å€ä»¥ä¸Šï¼Œ\né—œé—œé›£éï¼Œä½†å°±é—œé—œéå§\nææ‡¼ä¾†è‡ªç‚ºæœªçŸ¥\né‡åˆ°äº†ï¼Œå°±äº†è§£å®ƒ\näº†è§£äº†ï¼Œå°±ä¸å†å®³æ€• Reference # AWS RDS Documentation : Restoring a backup into an Amazon RDS for MySQL DB instance AWS RDS Documentation : Configuring binary log file position replication with an eternal source instance Rowan Udell : AWS IAM:PassRole explained ","date":"16 September 2025","permalink":"https://yangnianli.github.io/blog/restoring-a-backup-into-an-amazon-rds-for-mysql-db-instance-and-configuring-external-source-replication/","section":"Blog","summary":"","title":"[AWS] Restoring a backup into an Amazon RDS for MySQL DB instance and Configuring external source replication"},{"content":" Insanity is doing the same thing over and over and expecting a different result. ","date":null,"permalink":"https://yangnianli.github.io/blog/","section":"Blog","summary":"","title":"Blog"},{"content":"","date":null,"permalink":"https://yangnianli.github.io/tags/rds/","section":"Tags","summary":"","title":"Rds"},{"content":"","date":null,"permalink":"https://yangnianli.github.io/tags/sre/","section":"Tags","summary":"","title":"Sre"},{"content":"About Me # Yang He lives in Taichung City with his SPOF (wife) and two replicas\n- v1.0 (boy) and v2.0 (girl), both in primary school. mysql\u0026gt; SELECT -\u0026gt; `Name` AS Name , -\u0026gt; `JobTitle` AS JobTitle , -\u0026gt; `Description` AS Description -\u0026gt; FROM whoami \\G *************************** 1. row *************************** Name: Yang JobTitle: Database Administrator (DBA) / Database Reliability Engineer (DBRE) Description: æ“æœ‰ 10+ å¹´ DBA ç¶“é©—ï¼Œ å°ˆç²¾ MySQLï¼Œç®¡ç† TB ç´šè³‡æ–™åº«ã€è¶…é 600 å°ã€ç´„ 100 åº§ Cluster ç¶“é©—ã€‚ å…·å‚™è»Ÿé«”é–‹ç™¼èƒ½åŠ›ï¼Œç†Ÿæ‚‰ On-Premises ä»¥åŠ Cloud ( GCPã€AWS ) ç®¡ç†èˆ‡ç¶­é‹ç¶“é©—ï¼Œ ä¸¦æ“…é•·ä½¿ç”¨ Terraform ( OpenTofu )ã€Terragrunt ç­‰ IaC å·¥å…·ä¾†ç°¡åŒ–èˆ‡çµ±ä¸€å»ºç½®æµç¨‹ã€‚ ç†±æ„›å­¸ç¿’æ–°çŸ¥è­˜ä¾†è§£æ±ºæ—¥å¸¸ç¶­é‹å•é¡Œï¼Œç¿’æ…£ä¸€ç›´è¿½å•è‡ªå·±å•é¡Œç›´åˆ°æ²’æœ‰ç–‘å•ç‚ºæ­¢ï¼› ä¹Ÿæ¨‚æ–¼åˆ†äº«ï¼Œå…§å¿ƒä¸€ç›´ç›¸ä¿¡è‘—ã€Œç•¶æˆ‘èƒ½å¤ æ•™å­¸ä»–äººæ™‚ï¼Œæ‰ç®—æ˜¯çœŸæ­£å­¸æœƒã€‚ã€ å¦‚æœæ‚¨ä¹ŸèªåŒï¼Œæˆ‘æƒ³æˆ‘å€‘å¯ä»¥å¤šèŠèŠ ğŸ˜‡ 1 row in set (0.0007 sec) Work Experience #","date":null,"permalink":"https://yangnianli.github.io/about/","section":"Yang's Blog","summary":"","title":""}]